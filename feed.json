{
    "version": "https://jsonfeed.org/version/1",
    "title": "若批评不自由，则赞美无意义",
    "subtitle": "有梦书架",
    "icon": "https://limxtop1989.github.io/limxtop/images/favicon.ico",
    "description": "",
    "home_page_url": "https://limxtop1989.github.io/limxtop",
    "items": [
        {
            "id": "https://limxtop1989.github.io/limxtop/2023/05/07/word-card-user-manual/",
            "url": "https://limxtop1989.github.io/limxtop/2023/05/07/word-card-user-manual/",
            "title": "Android 单词卡片使用手册",
            "date_published": "2023-05-07T08:05:05.000Z",
            "content_html": "<h1 id=\"目录\"><a class=\"anchor\" href=\"#目录\">#</a> 目录</h1>\n<ol>\n<li>单词卡片效果图</li>\n<li>Android  单词卡片应用下载</li>\n<li>下载安装 GoldenDict 应用</li>\n<li>下载词库文件并放置在 GoldenDict 目录</li>\n</ol>\n<h1 id=\"单词卡片效果图\"><a class=\"anchor\" href=\"#单词卡片效果图\">#</a> 单词卡片效果图</h1>\n<p><img data-src=\"https://s3.uuu.ovh/imgs/2023/05/21/47f2424656228f22.gif\" alt=\"\" /><br />\n对于不懂的单词，可以点击搜索框，弹窗显示词典，目前提供朗文英英，牛津英汉等词典，丰富的释义，词源，例句和朗读，在丰富的链接下，让学习者掌握它的含义，用法和并训练听力。私以为，单纯记忆一个单词背后的汉语意思，只能知道它的含义，无法掌握它的用法，更不会听说。我们国人的哑巴英语就是这样学成的。关于我们很多国人没能掌握英语听说能力的根源及其有效掌握方法，在<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iZXdhdGVycy5tZS9saW14dG9wLzIwMjEvMDgvMTgvRW5nbGlzaC1pbnRyb2R1Y3Rpb24v\">英语自学指南</span>详细解释，欢迎阅读。</p>\n<h1 id=\"单词卡片下载\"><a class=\"anchor\" href=\"#单词卡片下载\">#</a> 单词卡片下载</h1>\n<p>下载地址： <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucGd5ZXIuY29tL21nQmZ1Ng==\">https://www.pgyer.com/mgBfu6</span></p>\n<h1 id=\"下载安装goldendict\"><a class=\"anchor\" href=\"#下载安装goldendict\">#</a> 下载安装 GoldenDict</h1>\n<p>选择以下可用方案下载安装即可</p>\n<ol>\n<li>下载链接： <span class=\"exturl\" data-url=\"aHR0cDovL21hcmtldC5hbmRyb2lkLmNvbS9kZXRhaWxzP2lkPW1vYmkuZ29sZGVuZGljdC5hbmRyb2lkLmZyZWU=\">http://market.android.com/details?id=mobi.goldendict.android.free</span></li>\n<li>如果用浏览器无法下载安装 GoldenDict，自行打开 Android 手机自带的应用市场，搜素 GoldenDict，如果这里搜索的到，下载安装亦可。</li>\n</ol>\n<p>第一次启动会提示安装词库（如下图），并在 Android 手机存储器根目录创建 GoldenDict 目录（即文件夹）<br />\n<img data-src=\"https://s3.uuu.ovh/imgs/2023/05/07/41790adbafc47528.png\" width=\"30%\" height = \"30%\"></p>\n<h1 id=\"下载词库文件并放置在手机存储器根目录下的goldendict\"><a class=\"anchor\" href=\"#下载词库文件并放置在手机存储器根目录下的goldendict\">#</a> 下载词库文件，并放置在手机存储器根目录下的 GoldenDict</h1>\n<p>下载链接: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMW9WNkF4UlVsWDFjN21wRTM1MmJ0OHc=\">https://pan.baidu.com/s/1oV6AxRUlX1c7mpE352bt8w</span> 提取码: uxtw</p>\n<ol>\n<li>Android 手机下载以下词库文件即可，下载完毕<strong>解压</strong>（注意⚠️，必须解压），并放到手机存储器的 GoldenDict 目录。</li>\n</ol>\n<ul>\n<li>En-En_Longman_DOCE5</li>\n<li>En-En_Merriam_Webster11</li>\n<li>En-En_OALD8</li>\n<li>Oxford_Advanced_Learner_English-Chinese_Dictionary-4th.bgl</li>\n</ul>\n<p>作为参考和对照，这个是我 Android Pixel 手机 File 应用打开的 GoldenDict 目录截图<br />\n<img data-src=\"https://s3.uuu.ovh/imgs/2023/05/07/367486e3a757df2e.png\" width=\"30%\" height = \"30%\"><br />\n这个是使用 adb 命令，进入手机存储器文件系统，GodenDict 目录路径和目录下的词库文件</p>\n<pre><code>bramble:/storage/self/primary/GoldenDict $ pwd\n/storage/self/primary/GoldenDict\nbramble:/storage/self/primary/GoldenDict $ ls -al\ntotal 11412\ndrwx------ 3 u0_a256 u0_a256     3452 2023-04-20 23:58 .config\ndrwx------ 2 u0_a256 u0_a256     3452 2023-04-20 23:51 En-En_Longman_DOCE5\ndrwx------ 2 u0_a256 u0_a256     3452 2023-04-20 23:56 En-En_Merriam_Webster11\ndrwx------ 2 u0_a256 u0_a256     3452 2023-04-20 23:56 En-En_OALD8\n-rw------- 1 u0_a256 u0_a256 11661832 2021-06-01 23:11 Oxford_Advanced_Learner_English-Chinese_Dictionary-4th.bgl\n</code></pre>\n<ol start=\"2\">\n<li>重新启动 GoldenDict，开始索引词库。完毕后可以在搜索框输入单词查询。<br />\n<img data-src=\"https://s3.uuu.ovh/imgs/2023/05/07/969c769bb87bb2ba.png\" width=\"30%\" height = \"30%\"></li>\n</ol>\n<h1 id=\"最后\"><a class=\"anchor\" href=\"#最后\">#</a> 最后</h1>\n<p>如果有遇到任何问题，特别是下载词库文件并放置在手机存储器指定目录这个步骤。欢迎留下评论，我会尽力协助。</p>\n",
            "tags": [
                "单词卡片, word card"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2023/04/23/sound-of-April/",
            "url": "https://limxtop1989.github.io/limxtop/2023/04/23/sound-of-April/",
            "title": "四月之声",
            "date_published": "2023-04-23T00:46:48.000Z",
            "content_html": "<p><img data-src=\"https://s3.uuu.ovh/imgs/2023/04/23/8cfd203584078381.jpeg\" alt=\"\" /></p>\n<p>它没有一帧具体画面，却让闻者动容，潸然泪下</p>\n<p>每一句话都是网上公开的合法内容，却被视为洪水猛兽</p>\n<p>它的力量来源于真实</p>\n<p>它的殉道戳破了一个鲜为人知的谎言</p>\n<p>在这个谎言里他们说人民至上</p>\n<p>but they prohibit the people from singing</p>\n<p>众生平等自由，人民不需要至上</p>\n<p>“一个健康的社会不应该只有一种声音”</p>\n<p>互联网有记忆，但人民也善忘</p>\n<p>斯人已去，文亮的声音雕刻在遥远的纽约中央公园的木椅上，成了永恒</p>\n<p><img data-src=\"https://s3.uuu.ovh/imgs/2023/04/23/9f1af667ea60f181.jpeg\" alt=\"\" /></p>\n",
            "tags": [
                "四月之声"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2023/03/18/protest/",
            "url": "https://limxtop1989.github.io/limxtop/2023/03/18/protest/",
            "title": "乌鲁木齐路",
            "date_published": "2023-03-18T15:29:25.000Z",
            "content_html": "<blockquote>\n<p>如果天空是黑暗的，那就摸黑生存；如果发出声音是危险的，那就保持沉默；如果自觉无力发光，那就蜷伏于墙角。但是，不要习惯了黑暗就为黑暗辩护，也不要为自己的苟且而得意，不要嘲讽那些比自己更勇敢的人。我们可以卑微如尘土，但不可扭曲如蛆虫。</p>\n</blockquote>\n<p>从刚真正认识 J，一见如故约好一起吃饭，听她娓娓道来于第二天晚上在乌鲁木齐中路被抓的经历，到真正吃饭，已经是差不多两个月之后。</p>\n<p>席间彼此交换很多想法和意见，谈及她自己被抓的经历，我自己思想的塑造和改变，也展开解释君子和而不同，原初状态，无知之幕…… 概念。都没怎么顾及餐食，牛排慢悠悠吃完，羊排凉了，沙拉与汤水在有一搭没一搭中，渐渐稀少，直到临近餐馆打烊，要来盒子打包一块甜点，才从斯比特花园买单走出来，沿着人民广场，一同步行到她家小区的门口。即使如此，好些话依然未能来得及说出口。</p>\n<p>那段时间，她还在云南某地度假，看到第一天，周六晚上的乌鲁木齐路的空前盛况。她赶了飞机回来已经是第二天，暮色笼罩城市上空的时候，乌鲁木齐路早已人头攒动，车子已经开不进去。她只能在复兴西路从出租车下来步行。</p>\n<p>“第二天没什么口号，一直在唱国歌，唱了好多轮。也有开车在那边拿喇叭炸音乐，放悲惨世界那首。”</p>\n<p>J 走了十几分钟，看到警察在实施抓捕，有小姑娘被抓着，身体贴着地面拖行，衣服都掉出来了，有小姐姐看这场面，情绪失控，不由自主地伸手去拦，也被逮捕了。也有穿裙子的女孩子被逮捕，抬起来，挣扎中裙子掉出来。当时 J 举起手机拍摄，然后她也被抓了，被带上守候在路边的大巴车。不成想自己不远千里回来，雄赳赳气昂昂地出发，结果还没来得及呐喊助威，就戛然而止。</p>\n<p>怀揣着警察执法需要执法记录，自己拿手机在公众场合拍摄警察执法，不仅无可厚非，更是应有之举的想法，在大巴上，她理直气壮地朝警察吼了 “你有手有脚为什么要干这样的事情，站在人民对立面……”</p>\n<p>事后和朋友回顾谈起时，依然心有余悸，当时的冲动和言辞激烈，也许是幸好自己是女儿身，或者对方警察比较文明克制，不然免不了和有些其他人一样，挨揍。有几个朋友当时也在现场，从他们分享出来的视频里，看到有男人在窗帘收起的大巴座位上，被扇脸了。</p>\n<p>和朋友分别上了不同的大巴，半夜自己被押往徐汇枫林路派出所，彻夜未眠。屋里的灯光耀眼如昼，几个辅警在旁边，边玩着手机边看着他们。靠着大家找各种理由上厕所喝水，路过走廊偷看时钟回来报时，才知道今夕何时。出来重新呼吸自由的空气时，已经是第二天晚上十一点半。</p>\n<p>那位伸手挺身而出的小姐姐，在派出所接受问询时，是蹲在地上的，一同扫地的还有人类的尊严，J 朋友当时面对此情此景，自己情绪也很激动直接哭了。</p>\n<p>“在关押的二十四小时里面有水喝，第二天也提供了中饭和晚饭。采集了血液指纹声纹，手机手表 都被没收，并且需要提供密码，进行采集。会对手机里的照片视频，微信对话，以及一些软件进行询问并截图。其中一部分手机还未归还，作为证物保留。</p>\n<p>做了笔录，具体是描述为什么会在那个时间出现，在那个地点做了些什么等等等。当然也写了悔过书并签字。</p>\n<p>因为在整个过程中我没有任何过激行为，非常配合，所以也没有受到任何暴力。有一个屡次没有提供正确的解锁密码，导致 iPhone 永久锁住，他被带进邻近的厕所，拳脚相加和哀嚎声夹杂，响彻拘留室。”</p>\n<p>J 补充说，“在派出所，大家真的都很好，就是能感觉到是很善良的人，会互相帮助的那种。”</p>\n<p>她朋友在的那个派出所，有个人生病了，然后大家都在极力为他争取特殊照顾，轮流去给他倒点水什么的。第二天朋友被释放的时候，有一个小姑娘进来了，他看到有个一直很沉默的大叔特地去嘱咐看守所的警察，说她一个人会害怕，要多照顾一下什么的。因为大家都是成群结队关进去的，她自己独自一人，无人作伴。</p>\n<p>辅警有好有坏，狱友们窃窃私语时会被凶，但也有辅警和 J 小姐悄悄说：“如果不是有老婆孩子，他才不做辅警，他支持大家。很敬佩大家，敬佩第一天喊口号的人们。”</p>\n<p>“问询我的警察其实就还挺好的，一直在引导我。问我是不是只是看看 ins，就是不要说那两个蓝色的应用。问我只是去凑个热闹路过对不对。下次不要去凑热闹啦。怎么获取信息的，通过微博是不是？”</p>\n<p>有些人就没这么幸运了，还蛮凶的，毕竟派出所很小，隔壁的声音都听得到。</p>\n<p>“还有几个外国人的，有一个外国人一直在找人问。试图理解整件事情，因为他不理解怎么会被抓进来。”</p>\n<p>“大家关在一起，后面走进来的人一个个跟走秀一样。一幅大家都没做错什么，他们凭什么这样的理直气壮。非常自信，坦然以对，自信地给人一种走秀的感觉。下面的人有的还会起哄鼓掌特别搞笑。其中一个男生一身黑色带了个亚麻布的包。然后一坐下来，就从包里拿出来一本书，在那边看。”</p>\n<p>“还有个记者也进来了，特意说了和电视台没关系自己来的。同一位警察，和她说了不会通报到台里，让她自己找个理由解释为什么礼拜一没去上班在现场，不然的话什么后果她自己清楚巴拉巴拉。”</p>\n<p>于是，大家给出了天马行空，好玩有趣的解释。</p>\n<p>“有个大叔说他是去宣扬习思想的。”</p>\n<p>“和警察一起疏导人群。”</p>\n<p>｜早前就做笔录的注意事项，咨询过人权律师，他的答复是：做笔录时，实话实说即可。最后签字前，务必仔细阅读记录，不合事实的部分，要求整改，不然可以拒绝签字。否则签字之后，具备法律效应，出事了，律师即使舌灿莲花，也束手无策。</p>\n<p>第二天是周日，我所在的楼宇被封锁，解封已经是下午邻近四点，彼时我已经知道乌鲁木齐路的事。但因为已经约好和邻居们一起在植物园玩飞盘，结束后想过去已经有些晚，便作罢。</p>\n<p>我去乌鲁木齐路已经是第三天晚上，周一临近下班的时候，查了下地图，身后的同事瞄见了检索的 “乌鲁木齐路”，紧张地说了句 “你在干危险的事！”，突然自己有种图谋不轨，意图败露，被抓现行的局促。昨天还听到身后的他们，在谈论网上看到的，境外势力给上街的人发钱的事。其实单从常识和经验出发，就知道大概是栽赃嫁祸，毕竟无休止的封控，影响国家经济和人民的满意，如果真亡我之心不死，不仅不应该发钱支持人民上街，还应该对清零政策添油加醋，呐喊助威才是。更何况，看到传说中的视频，道具粗陋，对面还听着一辆闪着警灯的警车。我自是知道，西方，特别是美国一些基金会给国内的一些组织提供经费赞助，中国政府也有资助海外机构从事活动，特别是解放初期，向东南亚输出革命，这无可厚非，大家都彼此彼此，实事求是，明辨真假就好。自己离开办公室上了地铁，从常熟路站出来，骑着自行车，若无其事地沿着乌鲁木齐和安福路绕了一圈，行人寥寥无几，警察在各个路口设立岗哨，在偏僻的路上，停靠着几辆大巴车，风声鹤唳，草木皆兵。</p>\n<p>口号，其实在第一天已经出现，当时有人开始喊出来，声音很轻很弱。现场有人在后来接受采访谈及为什么会跟着喊时，他回答说我只是觉得提出这样的口号需要勇气，也是我们的心声，如果自己不跟着喊，会让勇士觉得孤立无援，这是道德，良知的堕落。</p>\n<blockquote>\n<p>为众人抱薪者，不可使其冻毙于风雪，为自由开道者，不可令其困厄于荆棘。</p>\n</blockquote>\n<p>我由衷地佩服这些上街，发出呐喊的年轻人的勇气和担当。无需他人的领导和组织，大家为了一个共同的目标或者感觉到使命的召唤 “It is my duty！” 而聚集在一起，喊口号，践行白纸黑字写在宪法里的公民权利。</p>\n<p>清零政策的结束，当然不只是因为全国各地，此起彼伏的街头聚集抗议。这在举国维稳力量面前，不堪一击。从党国一贯的作风来看，更可能是从未公开的数据而言，疫情的传播已经无法通过粗暴的封控和全员核酸检测有效地遏制，而成本和代价已经无可承受，放开是无奈之下的选择，只是抗议刚好迎合了契机，推波助澜。</p>\n<p>由此可见，上街抗议的所作所为事后是何等的危险。结果好了，不算他们的功劳。结果变坏了，他们不仅逃不掉干系，无需宣传部门来让其背锅，人民群众的矛头会自己对准他们。从放开后，有人因为亲人感染新冠离去，发表和上街举白纸的人群誓不两立，不共戴天的言辞可以知道。这样假设的结果并非空穴来风。幸好放开后，并没有哀鸿遍野，否则他们虽说不至于洒血用来祭天，但背负一生骂名，恐怕无可避免。然而自身争取来的自由，人民正常生活的回归，经济的复苏，成了党国英明领导和决策的结果，也不见广大群众公开表达对他们的感激和支持。不仅与他们丝毫没有关联，反而在放开后，这些上街的年轻人，依然被秋后算账着。</p>\n<p><img data-src=\"https://pic.imgdb.cn/item/6415db18a682492fcc21dfbe.jpg\" alt=\"\" /></p>\n<p>在专制国家，鲜有纠错机制，大家更多的是唯命是从，坚定不移执行领袖意志。最坏的情况是大家都逆来顺受，乖乖的配合，然后我们在 23 年年底还在动态清零，密接隔离，全员核酸检测。国家决策层，仿佛是一个信息黑洞，只进不出。外界无法知道，为何会发生这样的转变，有什么依据。索性现在一切回归正轨，病毒仿佛一夜之间消失了一般，但依然难免一阵唏嘘。</p>\n<blockquote>\n<p>无私与勇气，也算是人类至高的美德。只是在这片土地上，鲜有被善待。</p>\n</blockquote>\n",
            "tags": [
                "乌鲁木齐"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2023/03/11/canvas-graphic-transform/",
            "url": "https://limxtop1989.github.io/limxtop/2023/03/11/canvas-graphic-transform/",
            "title": "Android 双指触控 位移 缩放 旋转",
            "date_published": "2023-03-11T13:13:48.000Z",
            "content_html": "<h1 id=\"效果\"><a class=\"anchor\" href=\"#效果\">#</a> 效果</h1>\n<p><img data-src=\"https://pic.imgdb.cn/item/6410989cebf10e5d53bddfb4.gif\" alt=\"demo\" /></p>\n<h1 id=\"代码实现\"><a class=\"anchor\" href=\"#代码实现\">#</a> 代码实现</h1>\n<figure class=\"highlight kotlin\"><figcaption data-lang=\"kotlin\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>maxim<span class=\"token punctuation\">.</span>opengl</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span>Context</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>graphics<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>view<span class=\"token punctuation\">.</span>MotionEvent</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>view<span class=\"token punctuation\">.</span>View</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>maxim<span class=\"token punctuation\">.</span>opengl<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>Constants</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>maxim<span class=\"token punctuation\">.</span>opengl<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>VLog</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>math<span class=\"token punctuation\">.</span>acos</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>math<span class=\"token punctuation\">.</span>asin</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>math<span class=\"token punctuation\">.</span>sqrt</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token function\">TouchEventView</span><span class=\"token punctuation\">(</span>context<span class=\"token operator\">:</span> Context<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">View</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> rect<span class=\"token operator\">:</span> RectF <span class=\"token operator\">=</span> <span class=\"token function\">RectF</span><span class=\"token punctuation\">(</span><span class=\"token number\">0f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400f</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400f</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> desRect <span class=\"token operator\">=</span> <span class=\"token function\">RectF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> matrixST <span class=\"token operator\">=</span> <span class=\"token function\">Matrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> paint<span class=\"token operator\">:</span> Paint <span class=\"token operator\">=</span> <span class=\"token function\">Paint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">init</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        paint<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> Color<span class=\"token punctuation\">.</span>RED</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> downX<span class=\"token operator\">:</span> Float <span class=\"token operator\">=</span> <span class=\"token number\">0f</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> downY<span class=\"token operator\">:</span> Float <span class=\"token operator\">=</span> <span class=\"token number\">0f</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> downPointerX<span class=\"token operator\">:</span> Float <span class=\"token operator\">=</span> <span class=\"token number\">0f</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> downPointerY<span class=\"token operator\">:</span> Float <span class=\"token operator\">=</span> <span class=\"token number\">0f</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> dx<span class=\"token operator\">:</span> Float <span class=\"token operator\">=</span> <span class=\"token number\">0f</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> dy<span class=\"token operator\">:</span> Float <span class=\"token operator\">=</span> <span class=\"token number\">0f</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> scale<span class=\"token operator\">:</span> Float <span class=\"token operator\">=</span> <span class=\"token number\">1f</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> angle<span class=\"token operator\">:</span> Float <span class=\"token operator\">=</span> <span class=\"token number\">0f</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onTouchEvent</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> MotionEvent<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Boolean <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>actionMasked<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            MotionEvent<span class=\"token punctuation\">.</span>ACTION_DOWN <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                downX <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getX</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                downY <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getY</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            MotionEvent<span class=\"token punctuation\">.</span>ACTION_POINTER_DOWN <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                downX <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getX</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                downY <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getY</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                downPointerX <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getX</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                downPointerY <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getY</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            MotionEvent<span class=\"token punctuation\">.</span>ACTION_MOVE <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>pointerCount <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                    <span class=\"token function\">translate</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    <span class=\"token function\">rotate</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                    <span class=\"token function\">zoom</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            MotionEvent<span class=\"token punctuation\">.</span>ACTION_POINTER_UP <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token keyword\">val</span> remainIndex <span class=\"token operator\">=</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>actionIndex <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span> <span class=\"token keyword\">else</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                downX <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getX</span><span class=\"token punctuation\">(</span>remainIndex<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> dx</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                downY <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getY</span><span class=\"token punctuation\">(</span>remainIndex<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> dy</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            MotionEvent<span class=\"token punctuation\">.</span>ACTION_UP<span class=\"token punctuation\">,</span> MotionEvent<span class=\"token punctuation\">.</span>ACTION_CANCEL <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token comment\">// NOP.</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token keyword\">else</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token comment\">// NOP.</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token function\">invalidate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">translate</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> MotionEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        dx <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getX</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> downX</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        dy <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getY</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> downY</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">zoom</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> MotionEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token keyword\">val</span> prev <span class=\"token operator\">=</span> <span class=\"token function\">distance</span><span class=\"token punctuation\">(</span>downX<span class=\"token punctuation\">,</span> downY<span class=\"token punctuation\">,</span> downPointerX<span class=\"token punctuation\">,</span> downPointerY<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token keyword\">val</span> next <span class=\"token operator\">=</span> <span class=\"token function\">distance</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            event<span class=\"token punctuation\">.</span><span class=\"token function\">getX</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getY</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>            event<span class=\"token punctuation\">.</span><span class=\"token function\">getX</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getY</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        scale <span class=\"token operator\">=</span> next <span class=\"token operator\">/</span> prev</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">rotate</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> MotionEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token keyword\">val</span> pointerX <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getX</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>        <span class=\"token keyword\">val</span> pointerY <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getY</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>        <span class=\"token comment\">// multiply y component by -1 to make y-axis points up.</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>        <span class=\"token comment\">// which maps view coordinate system to right-hand coordinate system.</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>        <span class=\"token keyword\">val</span> prevVector <span class=\"token operator\">=</span> <span class=\"token function\">Vector</span><span class=\"token punctuation\">(</span>downPointerX <span class=\"token operator\">-</span> downX<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>downPointerY <span class=\"token operator\">-</span> downY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0f</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>        <span class=\"token keyword\">val</span> nextVector <span class=\"token operator\">=</span> <span class=\"token function\">Vector</span><span class=\"token punctuation\">(</span>pointerX <span class=\"token operator\">-</span> event<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>pointerY <span class=\"token operator\">-</span> event<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0f</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>        <span class=\"token keyword\">val</span> cp<span class=\"token operator\">:</span> Vector <span class=\"token operator\">=</span> prevVector<span class=\"token punctuation\">.</span><span class=\"token function\">crossProduct</span><span class=\"token punctuation\">(</span>nextVector<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>        <span class=\"token comment\">// direction is 1 if the angle the next vector rotates with clockwise direction by</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>        <span class=\"token comment\">// from previous vector locates at [0, PI], otherwise is -1 if locates at [PI , 2 PI]</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>        <span class=\"token keyword\">val</span> direction <span class=\"token operator\">=</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cp<span class=\"token punctuation\">.</span>z <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> Rotate<span class=\"token punctuation\">.</span>CLOCKWISE<span class=\"token punctuation\">.</span>direction  <span class=\"token keyword\">else</span> Rotate<span class=\"token punctuation\">.</span>COUNTER_CLOCKWISE<span class=\"token punctuation\">.</span>direction</pre></td></tr><tr><td data-num=\"100\"></td><td><pre>        <span class=\"token comment\">// radian represent the angle between the two vectors, whose value locates in [0, PI] always.</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>        <span class=\"token keyword\">val</span> radian <span class=\"token operator\">=</span> <span class=\"token function\">acos</span><span class=\"token punctuation\">(</span>prevVector<span class=\"token punctuation\">.</span><span class=\"token function\">dotProduct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>nextVector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>prevVector<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> nextVector<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>        angle <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>radian <span class=\"token operator\">*</span> <span class=\"token number\">180</span> <span class=\"token operator\">/</span> Math<span class=\"token punctuation\">.</span>PI<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toFloat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> direction</pre></td></tr><tr><td data-num=\"103\"></td><td><pre>        VLog<span class=\"token punctuation\">.</span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"<span class=\"token interpolation variable\">$cp</span>, <span class=\"token interpolation variable\">$radian</span>, <span class=\"token interpolation variable\">$angle</span>\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">distance</span><span class=\"token punctuation\">(</span>x1<span class=\"token operator\">:</span> Float<span class=\"token punctuation\">,</span> y1<span class=\"token operator\">:</span> Float<span class=\"token punctuation\">,</span> x2<span class=\"token operator\">:</span> Float<span class=\"token punctuation\">,</span> y2<span class=\"token operator\">:</span> Float<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Float <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>        <span class=\"token keyword\">val</span> deltaX <span class=\"token operator\">=</span> x1 <span class=\"token operator\">-</span> x2</pre></td></tr><tr><td data-num=\"108\"></td><td><pre>        <span class=\"token keyword\">val</span> deltaY <span class=\"token operator\">=</span> y1 <span class=\"token operator\">-</span> y2</pre></td></tr><tr><td data-num=\"109\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>deltaX <span class=\"token operator\">*</span> deltaX <span class=\"token operator\">+</span> deltaY <span class=\"token operator\">*</span> deltaY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toDouble</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toFloat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onDraw</span><span class=\"token punctuation\">(</span>canvas<span class=\"token operator\">:</span> Canvas<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onDraw</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>        matrixST<span class=\"token punctuation\">.</span><span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>        matrixST<span class=\"token punctuation\">.</span><span class=\"token function\">postScale</span><span class=\"token punctuation\">(</span>scale<span class=\"token punctuation\">,</span> scale<span class=\"token punctuation\">,</span> rect<span class=\"token punctuation\">.</span><span class=\"token function\">centerX</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> rect<span class=\"token punctuation\">.</span><span class=\"token function\">centerY</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>        matrixST<span class=\"token punctuation\">.</span><span class=\"token function\">postTranslate</span><span class=\"token punctuation\">(</span>dx<span class=\"token punctuation\">,</span> dy<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>        matrixST<span class=\"token punctuation\">.</span><span class=\"token function\">mapRect</span><span class=\"token punctuation\">(</span>desRect<span class=\"token punctuation\">,</span> rect<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>        canvas<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>        <span class=\"token comment\">// clockwise when degrees is positive.</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>        canvas<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">rotate</span><span class=\"token punctuation\">(</span>angle<span class=\"token punctuation\">,</span> desRect<span class=\"token punctuation\">.</span><span class=\"token function\">centerX</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> desRect<span class=\"token punctuation\">.</span><span class=\"token function\">centerY</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>        canvas<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">drawRect</span><span class=\"token punctuation\">(</span>desRect<span class=\"token punctuation\">,</span> paint<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>        canvas<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>    <span class=\"token keyword\">enum</span> <span class=\"token keyword\">class</span> <span class=\"token function\">Rotate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">val</span> direction<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>        <span class=\"token function\">CLOCKWISE</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>        <span class=\"token function\">COUNTER_CLOCKWISE</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token function\">Vector</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">val</span> x<span class=\"token operator\">:</span> Float<span class=\"token punctuation\">,</span> <span class=\"token keyword\">val</span> y<span class=\"token operator\">:</span> Float<span class=\"token punctuation\">,</span> <span class=\"token keyword\">val</span> z<span class=\"token operator\">:</span> Float<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>        <span class=\"token keyword\">fun</span> <span class=\"token function\">dotProduct</span><span class=\"token punctuation\">(</span>v<span class=\"token operator\">:</span> Vector<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Float <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>            <span class=\"token keyword\">return</span> x <span class=\"token operator\">*</span> v<span class=\"token punctuation\">.</span>x <span class=\"token operator\">+</span> y <span class=\"token operator\">*</span> v<span class=\"token punctuation\">.</span>y <span class=\"token operator\">+</span> z <span class=\"token operator\">*</span> v<span class=\"token punctuation\">.</span>z</pre></td></tr><tr><td data-num=\"134\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>        <span class=\"token keyword\">fun</span> <span class=\"token function\">crossProduct</span><span class=\"token punctuation\">(</span>v<span class=\"token operator\">:</span> Vector<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Vector <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token function\">Vector</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>                y <span class=\"token operator\">*</span> v<span class=\"token punctuation\">.</span>z <span class=\"token operator\">-</span> z <span class=\"token operator\">*</span> v<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>                <span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">*</span> v<span class=\"token punctuation\">.</span>z <span class=\"token operator\">-</span> z <span class=\"token operator\">*</span> v<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>                x <span class=\"token operator\">*</span> v<span class=\"token punctuation\">.</span>y <span class=\"token operator\">-</span> y <span class=\"token operator\">*</span> v<span class=\"token punctuation\">.</span>x</pre></td></tr><tr><td data-num=\"141\"></td><td><pre>            <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>        <span class=\"token keyword\">fun</span> <span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Double <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">*</span> x <span class=\"token operator\">+</span> y <span class=\"token operator\">*</span> y <span class=\"token operator\">+</span> z <span class=\"token operator\">*</span> z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toDouble</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>        <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> String <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token string\">\"(<span class=\"token interpolation variable\">$x</span>, <span class=\"token interpolation variable\">$y</span>, <span class=\"token interpolation variable\">$z</span>)\"</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>        <span class=\"token keyword\">companion</span> <span class=\"token keyword\">object</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>            <span class=\"token keyword\">fun</span> <span class=\"token function\">crossProduct</span><span class=\"token punctuation\">(</span>v1<span class=\"token operator\">:</span> Vector<span class=\"token punctuation\">,</span> v2<span class=\"token operator\">:</span> Vector<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Float <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>                <span class=\"token keyword\">return</span> v1<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> v2<span class=\"token punctuation\">.</span>y <span class=\"token operator\">-</span> v1<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> v2<span class=\"token punctuation\">.</span>x</pre></td></tr><tr><td data-num=\"155\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>            <span class=\"token keyword\">fun</span> <span class=\"token function\">dotProduct</span><span class=\"token punctuation\">(</span>v1<span class=\"token operator\">:</span> Vector<span class=\"token punctuation\">,</span> v2<span class=\"token operator\">:</span> Vector<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Float <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>                <span class=\"token keyword\">return</span> v1<span class=\"token punctuation\">.</span>x <span class=\"token operator\">*</span> v2<span class=\"token punctuation\">.</span>x <span class=\"token operator\">+</span> v1<span class=\"token punctuation\">.</span>y <span class=\"token operator\">*</span> v2<span class=\"token punctuation\">.</span>y</pre></td></tr><tr><td data-num=\"159\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://s3.uuu.ovh/imgs/2023/03/15/3519b041b587e7e5.png\" alt=\"cross product and dot product\" /></p>\n<h1 id=\"向量点乘-dot-product\"><a class=\"anchor\" href=\"#向量点乘-dot-product\">#</a> 向量点乘 Dot Product</h1>\n\\begin{equation}\n\\vec{AB} \\cdot \\vec{AC} = \\parallel \\vec{AB} \\parallel * \\parallel \\vec{AC} \\parallel * \\cos\\theta  \\label{dotproduct} \\tag{1}\n\\end{equation}\n\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable width=\"100%\"><mtr><mtd width=\"50%\"></mtd><mtd><mrow><mover accent=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo>⃗</mo></mover><mo>⋅</mo><mover accent=\"true\"><mrow><mi>A</mi><mi>D</mi></mrow><mo>⃗</mo></mover><mo>=</mo><mo>∥</mo><mover accent=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo>⃗</mo></mover><mo>∥</mo><mo>∗</mo><mo>∥</mo><mover accent=\"true\"><mrow><mi>A</mi><mi>D</mi></mrow><mo>⃗</mo></mover><mo>∥</mo><mo>∗</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow></mtd><mtd width=\"50%\"></mtd><mtd><mtext>(2)</mtext></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\vec{AB} \\cdot \\vec{AD} = \\parallel \\vec{AB} \\parallel * \\parallel \\vec{AD} \\parallel * \\cos\\theta \\tag{2}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mrel\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.21633em;vertical-align:-0.25em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∗</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.21633em;vertical-align:-0.25em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\">∗</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span><span class=\"tag\"><span class=\"strut\" style=\"height:1.21633em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">(</span><span class=\"mord\"><span class=\"mord\">2</span></span><span class=\"mord\">)</span></span></span></span></span></span></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span> 的取值范围为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mi>π</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[0, \\pi]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mclose\">]</span></span></span></span>，由于从<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{AB}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> 顺时针旋转到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mrow><mi>A</mi><mi>C</mi></mrow><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{AC}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> 和从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{AB}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> 顺时针旋转到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mrow><mi>A</mi><mi>D</mi></mrow><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{AD}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> 计算出来的<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span> 是一样的，无法区分。而对于 <code>Canvas.rotate(degree)</code> ，当 <code>degree &gt; 0 </code> ，表示从向右方向顺时针旋转，当 <code>degree &lt; 0 </code> 时，表示向右方向逆时针旋转。所以，对于从<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{AB}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> 顺时针旋转 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi><mo>+</mo><mn>2</mn><mo>∗</mo><mo stretchy=\"false\">(</mo><mi>π</mi><mo>−</mo><mi>θ</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>2</mn><mi>π</mi><mo>−</mo><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\theta + 2 * (\\pi - \\theta) =  2 \\pi - \\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mrow><mi>A</mi><mi>D</mi></mrow><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{AD}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span>，相当于从<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{AB}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span> 逆时针旋转 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mrow><mi>A</mi><mi>D</mi></mrow><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{AD}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span></span></span></span>。 也即公示\\ref{dotproduct} 所求 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi><mo>∗</mo><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">\\theta * direction</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span></span></span></span> 即可。+1 表示顺时针， -1 表示逆时针，而 direction 的值可由叉乘计算得出。</p>\n<h1 id=\"向量叉乘-cross-product\"><a class=\"anchor\" href=\"#向量叉乘-cross-product\">#</a> 向量叉乘 Cross Product</h1>\n<p>如图左手坐标系，使用左手法则。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable width=\"100%\"><mtr><mtd width=\"50%\"></mtd><mtd><mrow><mover accent=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo>⃗</mo></mover><mo>×</mo><mover accent=\"true\"><mrow><mi>A</mi><mi>C</mi></mrow><mo>⃗</mo></mover><mo>=</mo><mover accent=\"true\"><msub><mi>N</mi><mi>c</mi></msub><mo>⃗</mo></mover></mrow></mtd><mtd width=\"50%\"></mtd><mtd><mtext>(3)</mtext></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\vec{AB} \\times \\vec{AC} = \\vec{N_c} \\tag{3}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0496599999999998em;vertical-align:-0.08333em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1163299999999998em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"tag\"><span class=\"strut\" style=\"height:1.21633em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">(</span><span class=\"mord\"><span class=\"mord\">3</span></span><span class=\"mord\">)</span></span></span></span></span></span></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mi>N</mi><mi>c</mi></msub><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{N_c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1163299999999998em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 指向 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mi>z</mi><mo separator=\"true\">,</mo><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">-z, direction = +1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">+</span><span class=\"mord\">1</span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable width=\"100%\"><mtr><mtd width=\"50%\"></mtd><mtd><mrow><mover accent=\"true\"><mrow><mi>A</mi><mi>B</mi></mrow><mo>⃗</mo></mover><mo>×</mo><mover accent=\"true\"><mrow><mi>A</mi><mi>D</mi></mrow><mo>⃗</mo></mover><mo>=</mo><mover accent=\"true\"><msub><mi>N</mi><mi>d</mi></msub><mo>⃗</mo></mover></mrow></mtd><mtd width=\"50%\"></mtd><mtd><mtext>(4)</mtext></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\vec{AB} \\times \\vec{AD} = \\vec{N_d} \\tag{4}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0496599999999998em;vertical-align:-0.08333em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9663299999999999em;vertical-align:0em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1163299999999998em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"tag\"><span class=\"strut\" style=\"height:1.21633em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">(</span><span class=\"mord\"><span class=\"mord\">4</span></span><span class=\"mord\">)</span></span></span></span></span></span></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mi>N</mi><mi>d</mi></msub><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{N_d}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1163299999999998em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9663299999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.25233em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2355em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 指向 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mi>z</mi><mo separator=\"true\">,</mo><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">+z, direction = -1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\">+</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span></p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ib29rLmRvdWJhbi5jb20vc3ViamVjdC8yNjgyNDkyMS8=\">Introduction to Linear Algebra</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vZGV2ZWxvcC91aS92aWV3cy90b3VjaC1hbmQtaW5wdXQvZ2VzdHVyZXMvbXVsdGk=\">Android multiple touch event</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTA0MTYyNzQ0ODYwNjg1\">使用斜率计算旋转角度</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTA0MTY2NzAwMDg5MzUx\">使用向量计算旋转角度</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC82NDcwNzI1OQ==\">三维叉乘 &amp; 坐标系</span></li>\n</ul>\n",
            "tags": [
                "Android",
                "Android Translate Scale Rotate, multiple touch event, Android 双指触控，位移，缩放，旋转"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2023/02/25/notice-time/",
            "url": "https://limxtop1989.github.io/limxtop/2023/02/25/notice-time/",
            "title": "看见时间",
            "date_published": "2023-02-25T03:53:23.000Z",
            "content_html": "<p>因缘巧合，在毕业两年多后的一趟公交车外，我看见了时间，明白了它到底是何物。</p>\n<p>那个上班等车的清晨，姗姗来迟的公交车未来得及靠站，一群候车的上班族便蜂拥而上，我没有参与，从容闲适地徘徊在候车亭等待下一班车的到来。心急火燎的人群几经努力尝试终有些人挤不上车，放弃撤退回来。不过，车子启动扬起的尘埃还未落定，下一班车就空荡荡地尾随而来，遗憾留下来的人愁眉渐次舒展开来。</p>\n<p>我知道，有些公司会规定迟到要扣钱，但即使没有这样的规矩，我依然能够理解他们挤着上车的举动。当前门空间被拥挤的人群塞得满满当当，司机总是奉劝还在门外挣扎的人，等下一班，很快就来。这是他们这个职业所能留给乘客一丝无奈的善意。</p>\n<p>我们有序上车，由于并非满载行驶，车子极其轻快，一下子就超车了。当我到站走下车回头一望时，上一趟公交车还在远处姗姗来迟。如果我刚才也随波逐流在人群中推搡上车，那我只能在此时此刻之后的几分钟的未来才能到达此地。也就是一个性格使然看似不经意间的选择，我提前到达了未来（本来应该是  <code>t2</code> ，结果是 <code>t1</code>  到达）。</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2023/02/25/14b5f2ba338fbc0d.png\" alt=\"figure timeline\" /></p>\n<p>那一刻，我仿佛看见了时间，滴答滴答，在自己生命场合里，刻下的尺度。我们的人生只有一次，没有彩排，没办法走到某一刻，有个旋钮可以把我们倒拨回过去，重新作出选择，对比看孰好孰坏。但只要自己不要碌碌无为，虚度光阴，贪图玩乐，像个母亲细心地呵护呱呱坠地的婴孩一样爱护自己的时间，这样自己就可以提前到达未来。在人生有限的生命里，自己可以走的更远，这样也许自己不惑之年所驻足的地方，却是曾经懵懂的自己或者他人活到耄耋之年才能到达。</p>\n<p>人有了点学识，方知自己过去的无知，也许因为意识到这点，便孜孜不倦地求知。学海无涯，回头不是岸，努力游到对岸才是。</p>\n<blockquote>\n<p>“人永远都无法知道自己该要什么，因为人只能活一次，既不能拿它跟前世相比，也不能在来生加以修正。没有任何方法可以检验哪种抉择是好的，因为不存在任何比较。一切都是马上经历，仅此一次，不能准备。—— 米兰・昆德拉”</p>\n</blockquote>\n<p>很不幸，和大多数大道理都懂，小情绪却总是喷薄而出的小孩脾气一样。知道时间珍贵，应该珍惜时间，那些人生至关重要的清规戒律时常淹没在日常琐碎繁杂的洪流里，知行合一是如此之难。</p>\n<p>但其实也没有必要对此太过于介怀。有道是人生苦短，及时行乐。没有必要一直如同苦行僧，偶尔需要些许闲暇的时光，让自己走出家门坐在双层巴士上发呆，看着街边的房屋，树叶如白驹过隙般从车窗前一晃而过。和朋友踩在松软的沙滩或者硬实的木栈道，任凭裹挟着咸味的海风涌入鼻腔，或者坐在自己宽大的书桌前摊开百读不厌，看似百无一用的课外书籍。接受偶尔不那么功利目的，虚度光阴的自己。</p>\n",
            "tags": [
                "时间, time"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2023/02/04/android-message-loop/",
            "url": "https://limxtop1989.github.io/limxtop/2023/02/04/android-message-loop/",
            "title": "Android消息循环",
            "date_published": "2023-02-04T07:59:56.000Z",
            "content_html": "<h1 id=\"题记\"><a class=\"anchor\" href=\"#题记\">#</a> 题记</h1>\n<p>本文又几年前给同事们培训准备的资料整理而来，只是凭借印象，粗略记录框架原理和要点，需要新人花不少功夫自学探索。待闲暇时，待我重新阅读源码，再详细展开。读懂消息循环，需要具备英语阅读能力，如果尚缺，可以阅读<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iZXdhdGVycy5tZS9saW14dG9wLzIwMjEvMDgvMTgvRW5nbGlzaC1pbnRyb2R1Y3Rpb24v\">英语自学指南</span>。</p>\n<h1 id=\"用法\"><a class=\"anchor\" href=\"#用法\">#</a> 用法</h1>\n<p>线程是不具备消息循环的，需要调用 <code>Looper.prepare()</code>  &amp;  <code>Looper.loop()</code>  才开启消息循环。系统已经在 <code>ActivityThread</code>  帮忙主线程开启了消息循环，代码如下。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">Looper</span><span class=\"token punctuation\">.</span><span class=\"token function\">prepareMainLooper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">ActivityThread</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ActivityThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sMainThreadHandler <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            sMainThreadHandler <span class=\"token operator\">=</span> thread<span class=\"token punctuation\">.</span><span class=\"token function\">getHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Looper</span><span class=\"token punctuation\">.</span><span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Main thread loop unexpectedly exited\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>所以，主线程是不可以调用 <code>looper.quit()</code> ，不然抛出 <code>new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;)</code> ，而 WorkerThread 如果开启消息循环，不再需要时，得调用 <code>looper.quit()</code> ，否则内存泄漏。</p>\n<h1 id=\"类图\"><a class=\"anchor\" href=\"#类图\">#</a> 类图</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2023/02/04/e2a2de9b66a113c6.png\" alt=\"\" /><br />\n每个线程都有自己的消息循环机制和队列，实现的关键是将 Looper 对象保存在当前 <code>Thread</code>  的 <code>ThreadLocalMap</code> ，&lt;key, value&gt; = &lt;Looper.sThreadLocal, Looper&gt;.</p>\n<p>android.os.Looper#prepare(boolean)</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">boolean</span> quitAllowed<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sThreadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Only one Looper may be created per thread\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        sThreadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Looper</span><span class=\"token punctuation\">(</span>quitAllowed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>java.lang.ThreadLocal#set</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * Sets the current thread's copy of this thread-local variable</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     * to the specified value.  Most subclasses will have no need to</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * override this method, relying solely on the &#123;@link #initialValue&#125;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * method to set the values of thread-locals.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     * @param value the value to be stored in the current thread's copy of</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     *        this thread-local.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">ThreadLocalMap</span> map <span class=\"token operator\">=</span> <span class=\"token function\">getMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>map <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            map<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token function\">createMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"overview\"><a class=\"anchor\" href=\"#overview\">#</a> Overview</h1>\n<p>消息队列的消息有指定执行时间，消息循环机制是如何做到准时处理消息的？</p>\n<ol>\n<li>消息循环机制初始化时，在 native 层，监听 `mWakeEventFd。</li>\n<li>消息循环开始时，从消息队列里取消息，自然取不到，就在 native 等待 <code>mWakeEventFd</code>  事件</li>\n<li>handler 发送消息，并进入消息队列，native 层 在 mWakeEventFd 写入数据，唤醒第二步的等待事件。</li>\n<li>第二步从等待中唤醒，读取消息队列的消息，如果消息执行时间是现在，则处理消息。否则计算执行时间和当前的时间差 <code>nextPollTimeoutMillis</code> ，重新插入消息队列，并在 native 层等待，等待超时参数是 <code>nextPollTimeoutMillis</code></li>\n</ol>\n<h1 id=\"nextpolltimeoutmillis\"><a class=\"anchor\" href=\"#nextpolltimeoutmillis\">#</a> nextPollTimeoutMillis</h1>\n<p><code>nextPollTimeoutMillis</code>  看似不起眼，其实是很重要的变量，它有三种类型的值，分别代表不同的含义。</p>\n<ol>\n<li>-1：消息队列没消息，native 使用 <code>wait()</code></li>\n<li>0：（TODO： ）</li>\n<li>自然数：消息队列最早执行的消息（队列头部的消息）在未来，当前没有消息处理，可以歇息。native 使用  <code>wait(int timeout)</code>  ，超时后自动从等待中返回，无需 write 事件唤醒。</li>\n</ol>\n<p>android.os.MessageQueue#next</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> nextPollTimeoutMillis <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token function\">nativePollOnce</span><span class=\"token punctuation\">(</span>ptr<span class=\"token punctuation\">,</span> nextPollTimeoutMillis<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token comment\">// Try to retrieve the next message.  Return if found.</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>msg <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>now <span class=\"token operator\">&lt;</span> msg<span class=\"token punctuation\">.</span>when<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                    <span class=\"token comment\">// Next message is not ready.  Set a timeout to wake up when it is ready.</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                    nextPollTimeoutMillis <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>when <span class=\"token operator\">-</span> now<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span>MAX_VALUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                    <span class=\"token keyword\">return</span> msg<span class=\"token punctuation\">;</span><span class=\"token comment\">// Got a message.</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>             <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                    nextPollTimeoutMillis <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// No more messages.</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>              <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token comment\">// A new message could have been delivered, so go back and look again for a pending message without waiting.</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            nextPollTimeoutMillis <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"prepare\"><a class=\"anchor\" href=\"#prepare\">#</a> Prepare</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2023/02/04/4b24b7075c896855.png\" alt=\"\" /><br />\n使用 Epoll API，在 mWakeEventFd 注册监听</p>\n<h1 id=\"loop-and-handle-message\"><a class=\"anchor\" href=\"#loop-and-handle-message\">#</a> Loop And Handle Message</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2023/02/04/c8230250364e5395.png\" alt=\"\" /><br />\n此时消息队列还没有消息，在 <code>epoll_wait</code>  等待</p>\n<h1 id=\"insert-message\"><a class=\"anchor\" href=\"#insert-message\">#</a> Insert Message</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2023/02/04/4b347d81a5ccef35.png\" alt=\"\" /><br />\n往消息队列插入消息后，往 <code>mWakeEventFd</code>  写入一个整数，唤醒 <code>poll_wait</code> ，从而 loop 循环中取出消息，接着处理 Message。</p>\n<h1 id=\"线程间通信\"><a class=\"anchor\" href=\"#线程间通信\">#</a> 线程间通信</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2023/02/04/ef7b63e078f95c70.png\" alt=\"\" /><br />\n通信线程双方，持有对方的 handler 实例的引用，通过 handler.sendMessage 往对方线程的消息队列发送消息，如此两个线程就可以彼此发送消息，实现通信。</p>\n<h1 id=\"消息作用域\"><a class=\"anchor\" href=\"#消息作用域\">#</a> 消息作用域</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2023/02/07/be19a511e4b0ac2b.png\" alt=\"\" /><br />\n哪个 Handler 发送的消息，最后出消息队列，仍由该 Handler 处理，所以不同的 Handler 实例，可以有相同的 What，而不会相互干扰。具体实现是 <code>handler.sendMessage(message)</code>  时， <code>handler</code>  对象保存在 <code>message.target</code>  字段。</p>\n<h1 id=\"threadlocal\"><a class=\"anchor\" href=\"#threadlocal\">#</a> ThreadLocal</h1>\n<h1 id=\"雷区\"><a class=\"anchor\" href=\"#雷区\">#</a> 雷区</h1>\n<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<p>[1] <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0Bjb3B5Y29uc3RydWN0L3RoZS1tZXRob2QtdG8tZXBvbGxzLW1hZG5lc3MtZDlkMmQ2Mzc4NjQy\">https://medium.com/@copyconstruct/the-method-to-epolls-madness-d9d2d6378642</span><br />\n[2 ] <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW43Lm9yZy9saW51eC9tYW4tcGFnZXMvbWFuNy9lcG9sbC43Lmh0bWw=\">https://man7.org/linux/man-pages/man7/epoll.7.html</span><br />\n[3] The Design of the UNIX Operating System<br />\n[4] /base/core/java/android/os/MessageQueue.java<br />\n[5] /frameworks/base/core/jni/android_os_MessageQueue.cpp<br />\n[6] /system/core/libutils/Looper.cpp</p>\n",
            "tags": [
                "Android",
                "Android, message loop, 消息循环"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2023/02/04/App-Lock-Architecture/",
            "url": "https://limxtop1989.github.io/limxtop/2023/02/04/App-Lock-Architecture/",
            "title": "应用锁架构",
            "date_published": "2023-02-04T05:05:02.000Z",
            "content_html": "<h1 id=\"需求描述\"><a class=\"anchor\" href=\"#需求描述\">#</a> 需求描述</h1>\n<p>提供给指定应用加锁机制，应用处于上锁状态时，启动该应用需要做解锁操作，否则不仅用户不能与之交互，其应用界面也不可见，包括在 SystemUI 的 Recent 界面，也不可见其缩略图。</p>\n<h1 id=\"入职接手的第一版架构\"><a class=\"anchor\" href=\"#入职接手的第一版架构\">#</a> 入职接手的第一版架构</h1>\n<p>ActivityThread handleActivityResume 发送广播给应用锁的接收器，启动 UnlockService 去查询数据库判断是否当前启动的 Activity 所在应用是否是上锁状态。图我就不画了，那代码不值得投入时间画架构图。主要缺点有</p>\n<ol>\n<li>监听应用启动，判断是否上锁状态耗时，被锁应用已经启动完毕，用户可见可能长达一秒钟后，UnlockActivity 才启动覆盖在上面。</li>\n<li>UnlockActivity &amp; 上锁状态的 Activity 不在同一个 ActivityTask，UnlockActivity 界面按 back，只能强制显示 Launcher，而不是上一个 Activity。</li>\n<li>应用锁数据并没有提供 API 给 SystemUI。</li>\n</ol>\n<h1 id=\"第二版重构架构\"><a class=\"anchor\" href=\"#第二版重构架构\">#</a> 第二版重构架构</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2023/02/04/726cb4bd64b70c2f.png\" alt=\"\" /><br />\n在 AMS 的 AppLock 模块，绑定 AppLock 的 Service，并保持连接，Activity 的启动事件都通知给 AppLock。AppLock 实现 ContentProvider 对外提供数据访问 API，以此解决第一版 1 &amp; 3 问题。<br />\n遗留缺点：</p>\n<ol>\n<li>对于需要登陆等操作的互联网应用，会启动 MainActivity 后，判断是跳转登陆 Activity，由于连续启动两个上锁状态的 Activity，两个 UnlockActivity 也随之而来，屏幕闪缩。对此，可以单独为 MainActivity 加入过滤列表，不检测上锁解决，但这并非是好的方案。</li>\n</ol>\n<h1 id=\"第三版重构架构\"><a class=\"anchor\" href=\"#第三版重构架构\">#</a> 第三版重构架构</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2023/02/04/f55970d40056afff.png\" alt=\"\" /><br />\n开机后，读取并监听应用锁的数据，（主要是应用是否是上锁状态），应用启动后，在 AMS 检测是否上锁状态，将 Intent 保留在 IntentSender，原始 Intent 篡改为启动 UnlockActivity 的 Intent，制定当前 ActivityTask 启动 UnlockActivity，如此移花接木。解锁后，从 Intent 取出 IntentSender 重新发送请求给 AMS。至此，应用锁几乎完美无缺，久经测试同学的诸多考验。</p>\n",
            "tags": [
                "App Lock, AMS, ActivityManagerService, 应用锁, 应用锁架构"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2023/01/08/sunset/",
            "url": "https://limxtop1989.github.io/limxtop/2023/01/08/sunset/",
            "title": "晚霞",
            "date_published": "2023-01-08T04:01:26.000Z",
            "content_html": "<p><img data-src=\"https://p.ipic.vip/rvdkpt.jpg\" alt=\"\" /></p>\n<p>作者：火山<br />\n公众号：火山与木星<br />\n原文链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvYUlNYnFxSGRNbUpsM3FsbWdwTUYzQQ==\">https://mp.weixin.qq.com/s/aIMbqqHdMmJl3qlmgpMF3A</span></p>\n<p>这天晚上，天空出现了美丽的颜色，从高架桥间望到的那一片天，其色彩让人赞叹。走下过街天桥的楼梯，拥挤破旧的出租房屋渐渐逼近我的鼻尖，我突然想起一个汉字：霞。那片美丽的颜色是霞光或彩霞。同时我想起我久未见面的妹妹，她的名字就叫明霞。</p>\n<p>晚上，我枕着双臂躺在燠热的凉席上，隔壁房间里麻将搓动的声音袭入我租的这个房间里。我很想再看一次那美妙的颜色，我很想用相机把它捕捉下来。此刻外边的天空早已漆黑一片，那光泽早已消逝，这将是一个平凡而乏味的黑夜。</p>\n<p>星期日我不用上班，上了往南边岛屿去的地铁。一个人，我走到了江边，对岸仍是拥挤的出租屋，轮船在江面驶过。我在堤岸上坐了下来，手侧放着向朋友借来的相机。我想如果它在这个黄昏出现，在如此广阔的天空下与它邂逅会是一件多么壮观的事。我要捕捉到它二千米长的光泽与神奇。</p>\n<p>那一日是惨淡收场。它没有出现。八点时候，我收拾水壶和相机，离开堤岸，重新向大陆走去。</p>\n<p>天色昏暗，我有些认不出回去的路。我踏上一条碎石砌就的小径，它的另一头向树林深处延伸。风令树林哗啦作响。我凝视陡起的消失在树林里的路的尽头，恍然觉得有人正从那边走过来。我有一个预感，来人我十分熟悉。我抵抗住这一强烈的幻觉，扭过头横越这条小径向远处的柏油马路走去。</p>\n<p>我的工作是外贸公司里的跟单。外国客户在我们公司下单以后，我们负责寻找工厂，监管质量，直至产品顺利上柜离岸，和客户交付提单。</p>\n<p>公司里的人脾气都很坏，因为工作繁忙而沉重。我算是比较温和的，所以说话没人想听。我的老板对我说必须要变得强硬，对工厂不能心软，这些厂家都是些贪婪和弄虚作假的人，没有什么值得同情。</p>\n<p>办公室里和我关系友好的一个女孩子坐在我的对面。上个礼拜日我和她坐在茶餐厅里，她告诉我她担心出不了手头上那批货会被老板责骂。我默默听着，把那碗椰汁西米露一勺一勺吃完。</p>\n<p>我知道在那条小径上向我走近的是谁。那只能是我的妹妹。我很后悔自己做过的一些事，比如十几岁时和她一起用汤水喂弃猫，她更小的时候，我领着她到处游荡等等。</p>\n<p>有一件事我很不情愿想起。大约在初三的时候，我早上和她一起出门去上学，她从楼梯上滑倒，坐在地上哇哇大哭。在充满痛苦和自卑的十六岁的那个清晨，我没有像以往一样赶紧去抱起我的妹妹，我只是站在楼梯的高处，对她冷酷说出 —— 你自己爬起来。</p>\n<p>从此以后，我的妹妹和我疏离起来。而我念完大学，并到另一个城市谋生以后，几乎把她忘记了。每次过年回家，我都会在客厅里见到一个平凡的女孩子，和远方归来的父亲兄弟闲聊几句以后就戴着耳机躲进房间里。那个房间里满是言情小说、长毛熊、韩国明星的贴纸。</p>\n<p>天气预报能告诉我的只是何时有雨、多云，阴天或起风。它不能告诉我何时天空会出现彩霞。城市里没有人关注这个。</p>\n<p>每天下班后一走出办公室，我都抬头搜寻天空，期待在被楼房和高架桥分割的间隙里，能找到它的踪影。</p>\n<p>某一日，我坐在公共汽车上。车厢里减肥茶的广告声震耳欲聋，一个中年妇女在尖声说话。我看着窗外，车驶上高架桥，楼房阳台布满积尘，窗户紧闭，我不能想象怎么有人可以睡在和马路只隔一层窗户的地方，他们怎么可以入眠。他们会否连发梦也是梦到自己在马路上或公共汽车上呢？对于我，我是无法在这样的楼房中入睡的，我不能忍受汽车引擎持续震动所引起的那种晕眩感。</p>\n<p>突然，在楼房的间隙里，它出现了！公共汽车恰好在这时候到站！门一打开，我就手提相机，一跃而出……</p>\n<p>我被后边的车子撞到了。天旋地转，某些人对我的围观议论声中，我想起自己在十四岁，读初一的时候，有一段时间每天傍晚都骑自行车载妹妹去西边的小学操场。那里有一片广阔的田野，有不被房屋阻隔的天空，那里几乎每晚都会有让我们翘首以待的晚霞。</p>\n<p>妹妹喜欢我载她去看日落，除了天空美丽，也许还因为我如果有两角钱，总会为她买一条雪条。她会说：“你吃上面的一截，下面的一截是我的。”</p>\n",
            "tags": [
                "晚霞"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2023/01/08/azhen/",
            "url": "https://limxtop1989.github.io/limxtop/2023/01/08/azhen/",
            "title": "阿珍",
            "date_published": "2023-01-08T03:53:54.000Z",
            "content_html": "<p><img data-src=\"https://p.ipic.vip/pao9qx.jpg\" alt=\"\" /></p>\n<p>作者：火山<br />\n公众号：火山与木星<br />\n原文链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvVmdmTGdnbEF2aTJVWWNMNnczNkpldw==\">https://mp.weixin.qq.com/s/VgfLgglAvi2UYcL6w36Jew</span></p>\n<p>没有任何的变化，疲惫的他依旧回到了单间，关上门，他坐下来。而女友告诉他：她怀孕了，孩子不是他的。</p>\n<p>他往楼下跑去，手里提着滴血的水果刀，他穿过人群和乏睡的车厢，跑过清新的田野，躲到了老家房子的农具房里，锄头和泥墙保护他睡去。儿时喜欢过的穿着红色袜子的小女孩在梦里宣布他无罪。</p>\n<p>被杀死的女人在出租屋里复活，不是因为信仰和魔法，仅仅是因为她要躲开明日早上过来收房租的房东。</p>\n<p>这个烫着头发的丰腴女人名叫阿珍，肚子里有了一个孩子。她拿些卫生纸把胸口的窟窿捂住，提起行李包，穿着拖鞋离开了她和狗屎强过了两年的房间。绿色铁门很新很光滑，锁舌扣合的声音很清脆。</p>\n<p>她拖着血迹，到菜市场买了羊肉和萝卜，打电话给阿猫，说她今晚过去煮饭给他吃。阿猫说今晚不方便，他正在外地出差。她说她现在无家可归了，现在她只剩下他了，他不能不要她。</p>\n<p>阿猫说他的确是在外地，劝她先去朋友那里住几天。她蹲在墙根，说她想见他，眼泪引得路人侧目。阿猫说他没办法。</p>\n<p>几天以后，她过去找阿猫。没有人应门。打电话过去，他说他搬了。她说：你怎么没有和我说起过？阿猫说他忘记了。她问他现在在哪里，他说在家。她问：你的家在哪里？我过去找你。阿猫沉默了一阵，说：你不用来找我，还是去医院堕胎吧……</p>\n<p>不久，人们看到一个蓬头垢面的女人，穿着睡裙，卧在杨箕地铁站 C 出口边上，这一次她终于死了，污黑的右手攥着一个胶袋，里边是一斤已经发臭的羊肉，萝卜上有几个牙印，而左手放在肚皮上，这只手那么干净、那么温柔。</p>\n",
            "tags": [
                "阿珍"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2022/12/23/next-pole/",
            "url": "https://limxtop1989.github.io/limxtop/2022/12/23/next-pole/",
            "title": "下一棒",
            "date_published": "2022-12-23T14:24:25.000Z",
            "content_html": "<p>Author: 叨址 (沈超）<br />\nWechatID: abelkid</p>\n<p>爹：国家守护了我们三年，尽力了，现在每个人都是自己健康的第一责任人，剩下的日子要靠自己了。我通过医院的熟人屯了一批药，随时有症状了也不怕没床位。<br />\n我：做好日常防护，奥密克戎不可怕。正常备药就行，不要屯药。<br />\n爹：年轻人就是没有生活经验。<br />\n我：以前屯板蓝根、屯白醋、屯盐，这些反面经验我们也没有学到什么教训。<br />\n爹：傻瓜，别人都在屯药你不屯，到时候你就买不到药。<br />\n我：所以明知道是一部分人的行为导致另一部分人买不到药。<br />\n不屯药才能让大家都有药。<br />\n爹：孩子，这个社会就是人与人的竞争，资源是有限的，你有了我就没有。<br />\n我：我们让渡出部分权益组成社会，是因为社会能够让其中的每个人都得到超出个人部分的权益和帮助，这是一份公共契约。<br />\n成为利己主义者只攫取好处而损害其他的人利益，会破坏这份契约。因为只追求竞争就不需要组成社会，森林法则就够了。<br />\n更何况竞争应该是竞争把社会蛋糕做大的能力，而不是抢夺蛋糕的能力。我们发展生产到今天，不是那个物资匮乏的社会了。</p>\n<p>爹：错，即使资源不匮乏，也依然是掌握在部分人的手里。你看那么多的空房子，都是资本的炒作，资本家才是坏透了。<br />\n我：你觉得是他们抬高了房价？<br />\n爹：他们抬高了房价，他们造成了失业，他们导致了腐败，他们的科技与狠活伤害人们的身体，他们甚至敢核酸造假祸国殃民。<br />\n我：你有没有想过这些是国家的问题？土地政策抬高了房价，行业打压造成了失业，监管不善导致了环境和食品安全问题，权力寻租和媒体失能导致了腐败和造假？<br />\n爹：我们是发展中国家，现阶段是会有一些问题，但不能把所有问题都归结到国家。我们终究会解决这些问题，别的国家同样有问题。<br />\n我：但别的国家有好的纠错机制，民主、法制、言论，我们一个都没有，如何解决问题？<br />\n爹：我们有强有力的党的领导。<br />\n我：封控和放开都是靠党的领导。现在有效的疫苗、重点人群的接种率、增扩医疗资源、防挤兑预案、科学的宣导与社会心理建设一项都没做到，就靠一句 “每个人都是自己健康的第一责任人”？我们把太多的力气花在了全民核酸这种折腾大众的错误方向上，还怕苍蝇不来叮？<br />\n爹：从封控到放开，就说明我们也有自我纠错能力。<br />\n我：放开是因为各地爆发的抗议活动，是勇敢的大学生和团结的民众为我们争取来的，不是因为良心发现。<br />\n爹：做核酸是政府出钱，现在自测抗原需要花自己的钱，大家肯定更愿意免费做核酸。<br />\n我：这就是没有公民意识啊。<br />\n政府出的也是纳税人的钱，纳税就是我们让渡出去的权益的一部分。每个人让渡出的私权组成了公权力，政府、警察等公权力是用来保护私权而不是侵蚀私权的，所以公权力必须受到监督。<br />\n你有纳税的义务也有监督财政的权利，财政不受监督就会导致腐败。你兜里的钱是你自己的，你纳出去的税也是你的，这个国家也是你的。</p>\n<p>爹：我不管别人是什么样的，我们过好自己的就好了。<br />\n我：你催买房催婚催生的时候可不是这么说的，你说的是别人都在做为什么你不做。<br />\n爹：所以别人都在屯药，你也应该屯。<br />\n我：你刚才可不是这么说的，你批判资本家的时候说他们占用了别人的资源。<br />\n爹：怎么跟爸爸说话呢这是？读书读傻了你。<br />\n我：可是我在厦门已经买不到药了。你屯了药让有的人买不到药，别人屯药让我也买不到药。也就是说，你们屯的药最终导致了你们的下一代没有药。<br />\n爹：不对，正是因为我屯了药，我才能帮你这个买不到药的下一代兜底。</p>\n<p>爹：张雪峰说我的女儿不用考研，我给我女儿已经赚够了一生的钱，她不会为钱发愁，她不用为了生计去做她不想做的事情。<br />\n能够兜底的父母都会为下一代提供更好的环境。<br />\n我：更好的环境是指现在的环境并不好，至少张雪峰认为现在的考研并不是奔着好去的。<br />\n爹：是的，如果好，就不存在为了生计做不想做的事情。<br />\n我：张雪峰为了自己的下一代跳出这个环境，而让这个互害的法则继续侵害别人的下一代。我不能苟同。<br />\n爹：他改变不了什么，只能自求多福了。<br />\n我：那你觉得这是一个好的社会环境吗？<br />\n爹：不算。<br />\n我：你愿意你的后代像你一样挣扎在这样一个沉疴制度导致的自利互害的社会吗？<br />\n爹：不愿意，但又能怎么办呢？<br />\n我：你认为这不是个好的社会，也不愿意后代生活在这样的社会中，又认为你无法改变社会进程，那为什么要繁衍下一代来重复承受你的困境呢？<br />\n柏拉图讲爱情，黑格尔讲婚姻，似乎没有哲学家讲繁衍。如果人类还有一点自由意志的话，那么我认为是想要选择生活。第一步是想要，第二步是选择。罗曼・罗兰的 “热爱生活” 不能被理解为鸡汤式的自我麻醉，热爱生活的形式是依然想要、依然选择，而不是看清生活真相后的无奈妥协与苟且。<br />\n我们称颂乔布斯，称颂哥伦布，称颂一切改变世界的英雄，但源于希腊的个人英雄主义叙事的遗害是成功学，我们称颂的并不是 “想要” 改变世界的精神，而是 “成功” 改变世界的结果。如果说在漫长的人类历史中注定要掩埋那些未竟的努力和失败，那么缩短到一年之内的接力便可让我们看见清晰的脉络：四通桥上的孤勇者的标语响遍全国，A4 运动导致灵车飘移式的转向，推动这一切的是参与其中的每一个人，是自下而上的选择意愿，而不是某一个人的金牌令箭。<br />\n或许我们的 “想要” 并不像这短短几个月内的奇效，而这一次的事件也只是接力赛中的其中一棒，其中的关键在于每个人都放弃关于伟大的幻想，放弃一蹴而就的救世者叙事，承认聚沙成塔的公民之力，承认我们想要选择的生活。即使我们不是最后冲线的那一棒，也承认每一棒的功绩与不朽，跑好自己的一棒并交给下一代接棒人，最终才有可能让他们的下一代，生活在你所愿景的更美好的社会中。<br />\n为每代下一代推动更美好的社会，这才是繁衍的真义。</p>\n<p>以上仿苏格拉底对话录是虚构的，但以下对话是真实的，来自反派影评《响指之后，何去何从？》。</p>\n<p>杨超：特别听不得有一句话，&quot; 我也改变不了什么”。这句话首先是一个绝对的废话，包含着极大的狂妄和极大的自卑。废话，你当然改变不了什么，你一个人怎么可能改变什么，但是很多人这么说的时候，其实为后面放弃做准备的。反正我也干不了什么，我就这样了，以一种非常低调谦逊的状态，说一句非常狂妄，但是又抛弃责任的话。先是狂到上帝那去，然后再低到魔鬼那，把自己的所有责任全都放弃掉。</p>\n<p>波米：我们今天谈的你也改变不了行业，你改变不了世界。其实改变世界的过程是一个非常非常漫长的接力赛跑，而每一个人或者每一代人都以为自己跑的是最后一棒，都以为到自己那一棒的时候应该出成绩。</p>\n<p>但是有一个时期你会意识到，真正改变了世界的过程都不是 4 棒的问题，它可能是 40 棒、400 棒的问题，而你其实只是跑的第 20 棒、第 2 棒，但是在这样一个情况下，我们怎么做？</p>\n<p>还记不记得《银翼杀手 2049》，就是高司令，他开始其实就是这样的。他原以为自己是救世者，到中间他发现每个人都是这么想的，原来我是非常普通的一个，但是他因此干脆拿起枪来把自己崩了，或者说这事跟我没关系？他不是。他最后还是把自己的使命完成，所以最后一幕落在那，他把哈里森福特带到真正的天选之子那里，他自己躺在了外面。在那一刻，我觉得这是最牛逼的英雄成长。因为他完成了最大的觉醒，觉醒之处在于，他认识到了自己不是跑最后一棒的人，但与此同时我也要完成好我自己这一棒。</p>\n<p>改变世界的事在你这完不成，那你要做的事情是你把这种信念，你把刚才说的所有，你要坚持常识，坚持保持判断是非的能力，传给下一棒跑步的人，别掉棒，继续跑。</p>\n<p>杨超：而且我们的下一代人会不会有可能就是最后一棒，其实取决于我们跑的怎么样，说不定你要跑得非常好，下一代人成最后一棒。</p>\n<p>波米：你要把棒扔了，那肯定就没有下一棒，永远是一个未竟事业。</p>\n",
            "tags": []
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2022/12/03/it-is-my-duty/",
            "url": "https://limxtop1989.github.io/limxtop/2022/12/03/it-is-my-duty/",
            "title": "IT'S MY DUTY",
            "date_published": "2022-12-03T15:21:39.000Z",
            "content_html": "<p>author: 佚名</p>\n<p>我们是广场上的遗孤</p>\n<p>我们是野火后的新芽</p>\n<p>我们沉入长江底</p>\n<p>我们在动车下</p>\n<p>我们在贵州的大巴上別有用心</p>\n<p>我们在乌鲁木齐的大火里破坏稳定</p>\n<p>我们是在盛世中流浪的低端人口</p>\n<p>我们是在黑屋里呐喊的境外势力</p>\n<p>我们是失去家园的香港人</p>\n<p>我们是失去自由的维吾尔人……</p>\n<p>我们是刘晓波 我们是伊力哈木</p>\n<p>我们是刘贤斌 我们是陈卫</p>\n<p>我们是曹顺利 我们是李旺阳</p>\n<p>我们是孙志刚 我们是雷洋</p>\n<p>我们是杨佳 我们是吴淦</p>\n<p>我们是郭玉闪 我们是许志永</p>\n<p>我们是艾晓明 我们是寇延丁</p>\n<p>我们是卢宇 我们是叶海燕</p>\n<p>我们是高智晟 我们是余文生</p>\n<p>我们是夏霖 我们是王宇</p>\n<p>我们是李和平我们是王峭岭</p>\n<p>我们是张展 我们是黄思敏</p>\n<p>我们是李明哲 我们是桂敏海</p>\n<p>我们是高耀洁 我们是蒋彦永</p>\n<p>我们是李文亮 我们是彭载舟………</p>\n<p>我们在方舱里自救</p>\n<p>我们在铁链下自由</p>\n<p>我们是被删掉的声音</p>\n<p>我们是被开除的良心</p>\n<p>我们是最后一代软肋</p>\n<p>我们是非必要的未来</p>\n<p>“不能”</p>\n<p>“不明白”</p>\n<p>“不同意”</p>\n<p>我们曾经站到坦克前</p>\n<p>我们也曾站在四通桥上</p>\n<p>今天我们依旧站在这里</p>\n<p>我们明天还要站到你们面前 因为</p>\n<p>It's my duty!(这是我的责任)</p>\n<p>It's our duty!(这是我们的责任)</p>\n",
            "tags": [
                "it's my duty"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2022/11/28/fight-for-freedom/",
            "url": "https://limxtop1989.github.io/limxtop/2022/11/28/fight-for-freedom/",
            "title": "柳德米拉·乌利茨卡娅",
            "date_published": "2022-11-28T14:52:20.000Z",
            "content_html": "<p><img data-src=\"https://p.ipic.vip/eyupg5.jpg\" alt=\"\" /></p>\n<p>我们有雪亮的眼睛，<br />\n你有军警宪特。</p>\n<p>你有雄兵百万，<br />\n我们有人的尊严。</p>\n<p>我们是百姓和草根，<br />\n你是克格勃官员和权贵豪门。</p>\n<p>你有强大的盾牌壮胆，<br />\n我们全都赤手空拳。</p>\n<p>除非你是婴孩，<br />\n否则周身何须护具覆盖？</p>\n<p>我们并非来打架，只想表达，<br />\n你不需逢人就抓，</p>\n<p>不需要挥舞拳头和棍棒，<br />\n将无辜者扔进牢房，</p>\n<p>人们被分化<br />\n成普通民众和警察。</p>\n<p>我们是百姓和草根，<br />\n你是克格勃官员和权贵豪门......</p>\n<p>对我们来说，俄罗斯如此博大，<br />\n对你来说，它如同火山即将喷发</p>\n",
            "tags": []
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2022/10/19/how-to-make-money/",
            "url": "https://limxtop1989.github.io/limxtop/2022/10/19/how-to-make-money/",
            "title": "如何赚大钱",
            "date_published": "2022-10-19T14:53:22.000Z",
            "content_html": "<h1 id=\"题记\"><a class=\"anchor\" href=\"#题记\">#</a> 题记</h1>\n<p>创造财富是致富的一种直接的方式。（Creating wealth is a way to get rich.）而财富，是你身上拥有，且别人需要的东西。</p>\n<h1 id=\"最佳途径\"><a class=\"anchor\" href=\"#最佳途径\">#</a> 最佳途径</h1>\n<p>如果想变得富有，最好的方式是创立或者加盟初创科技公司，特别是攻克技术难题的公司。这是一种几百年来，屡试不爽可靠的致富方式。</p>\n<h1 id=\"打工人的职业选择\"><a class=\"anchor\" href=\"#打工人的职业选择\">#</a> 打工人的职业选择</h1>\n<p>经济上来看，初创公司相当于将全部的职业生涯压缩为短短的几年时间完成，而不是低强度的四十年，在这几年的时间里，你尽可能努力地工作。这可以通过让自己加倍努力工作达成，加班是一种方式，但不是唯一和优雅的方式。每天在办公室会有诸多工作事项，但并非他们都可以转化为同等的价值。</p>\n<ol>\n<li>有些工作并不能创造价值，或者收获甚微，比如因为公司的规则，不得不和同事做毫无意义的争论，或者撰写冗长的工作日报。特别是对那些日报没有洋洋洒洒上千字会被认为没有营养和内容的公司，请敬而远之。由此当我们考虑工作时间的时候，应该衡量的是有效工作时间，并将其最大化，而不是简单的考量工作时长。</li>\n<li>不同的工作，创造的价值不一样，花一年的时间搬砖砌墙，和花三年五载的漫长岁月，构思图灵机模型为世界从工业革命走向信息革命奠定基础，完全不能相提并论。</li>\n</ol>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>财富</mtext><mo>=</mo><mtext>有效工作时长</mtext><mo>∗</mo><mtext>单位时间创造的财富</mtext></mrow><annotation encoding=\"application/x-tex\">财富 = 有效工作时长 * 单位时间创造的财富\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord cjk_fallback\">财</span><span class=\"mord cjk_fallback\">富</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord cjk_fallback\">有</span><span class=\"mord cjk_fallback\">效</span><span class=\"mord cjk_fallback\">工</span><span class=\"mord cjk_fallback\">作</span><span class=\"mord cjk_fallback\">时</span><span class=\"mord cjk_fallback\">长</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord cjk_fallback\">单</span><span class=\"mord cjk_fallback\">位</span><span class=\"mord cjk_fallback\">时</span><span class=\"mord cjk_fallback\">间</span><span class=\"mord cjk_fallback\">创</span><span class=\"mord cjk_fallback\">造</span><span class=\"mord cjk_fallback\">的</span><span class=\"mord cjk_fallback\">财</span><span class=\"mord cjk_fallback\">富</span></span></span></span></span></p>\n<p>综上，当我们提高任何一个变量，都可以让财富增长。</p>\n<h1 id=\"复利效应\"><a class=\"anchor\" href=\"#复利效应\">#</a> 复利效应</h1>\n<p>今天的工作内容可以积累，为日后的工作做铺垫或者打基础，而不应该像一次性筷子，用过之后就丢弃，明天是全新的开始，新的轮回。这样每天进步一点点，假以时日，未来可期。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo>+</mo><mn>0.01</mn><msup><mo stretchy=\"false\">)</mo><mn>365</mn></msup><mo>=</mo><mn>37.783</mn></mrow><annotation encoding=\"application/x-tex\"> (1 + 0.01)^{365} = 37.783\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span><span class=\"mord mtight\">6</span><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\">7</span><span class=\"mord\">.</span><span class=\"mord\">7</span><span class=\"mord\">8</span><span class=\"mord\">3</span></span></span></span></span></p>\n<h1 id=\"规模效应\"><a class=\"anchor\" href=\"#规模效应\">#</a> 规模效应</h1>\n<p>一份投资 100 块，利润率是 10%，利润所得是 10，当投资规模扩大为 10 万，利润率几本是保持不变的，此时利润所得便是 1 万。当应用软件的单条广告收入甚微，甚至可以忽略不计，但当用户数成千上万过亿，相乘一下，依然收入不菲。</p>\n<h1 id=\"打工人的技能发展选择\"><a class=\"anchor\" href=\"#打工人的技能发展选择\">#</a> 打工人的技能发展选择</h1>\n<p>如若要获得更高的个人劳动报酬，可以掌握少数人掌握的技能，或者市场大量需要的技能，不管哪一种，都可以促成劳动力供给少于需求的局面，让自己变得稀缺，从而自然而然获得更高的报酬。如果可以兼而有之，则更好。工资是企业支付你的劳动技能的价格，其高低取决于技能是否稀缺。一旦技能稀缺，需要此技能的企业过多，企业只能提高支付价格以获取人才。无法提供更高价格的企业最后只能和人才失之交臂。如果还不大明白，请看下方经济学的供需理论。</p>\n<p>假设市场需要十个工人，工资是 100 每天，但市场上有 12 个工人，此时有两个工人必然面临失业，于是，他们只能降低收入期望，比如 80 每天，由于用人成本总体下降，从而吸引提供更低薪酬的用人单位进入市场招聘。劳动力供过于求如此，供给不足则反过来。</p>\n<p>需求指的是人们有能力购买，并愿意购买某个具体财货的欲望。显示的是其它因素不变的情况下（ceteris paribus），随着价格升降，某个体在每段时间内所愿意购买某财货的数量。</p>\n<p>在某一价格下，消费者愿意购买的某一货物总数量称为 “需求量”(quantity demanded)。在不同价格下，需求量会不同。需求也就是说价格与需求量的关系。若以图像表示，便称为 “需求曲线”。</p>\n<p>供给，指特定市场上在一定时期内，与每一销售价格相对应，生产者愿意且能供应的财货数量。但供给并不完全代表生产，它属于生产的一部分，但供给量并不即是生产者在计算一系列成本所愿意生产的数量。生产量依据利润最大化条件决定，它在短期往往是固定，但供给量则可以随时变动。也就是说生产量是虚拟的、是人们算出来的，而供给量是现实的、真实发生的量。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\"><img data-src=\"https://p.ipic.vip/bmbd03.jpg\" alt=\"\" /></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><em>标准的供给和需求模型：正斜率的是供给曲线，代表生产者愿意在某一价格水平下出售的物品数量；负斜率的是需求曲线，代表消费者愿意在某一价格水准下购买的数量。透过模型的分析，可发现两条曲线相交之处（均衡点）就是均衡价格和均衡产量。</em></td>\n</tr>\n</tbody>\n</table>\n<p>供求关系决定市场价格。</p>\n<ul>\n<li>供给稀缺不能满足有效需求，需求方不愿意得不到商品，愿支付更高的价格。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\"><img data-src=\"https://p.ipic.vip/jcqd1h.jpg\" alt=\"\" /></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><em>供给是蓝线 S，需求是红线 D，当需求由 D1 变动为 D2 时，成交的价格和数量也随之变动。</em></td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>供给充裕超过有效需求，商品不能全部出售，势必导致供给方降低价格增加有效需求。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\"><img data-src=\"https://p.ipic.vip/qx17ni.jpg\" alt=\"\" /></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><em>供给是蓝线 S，需求是红线 D，当供给由 S1 变动为 S2 时，成交的价格和数量也随之变动。</em></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"金钱不是财富\"><a class=\"anchor\" href=\"#金钱不是财富\">#</a> 金钱不是财富</h1>\n<p>如果想要创造财富，理解什么是财富将大有裨益。财富并非和金钱等同，财富伴随着人类历史，金钱或者货币是相对近期的发明。财富才是根本的，是可以满足人类需求的物品：食物，衣服，房子，汽车…… 你可以没有金钱货币，便拥有财富。财富才是我们需要的，金钱不是。但如果财富是如此重要，为什么我们经常谈论提及的是赚钱？这不过是一种简化：金钱是一种交换财富的介质，在实践中，财富并不总是方便直接交换。</p>\n<p>往往身上的财富并不能满足自己和家庭所需，你可以用现有的财富和别人的财富做交换。只是交换时，彼此并不能恰好拥有彼此所需可交换的财富，比如我有多余的汽车需要房子，但对方是需要汽车但没有房子，对方可以支付我房子等额的金钱货币，然后我再用这些金钱找第三者买房子。或者因为财富不好分割，但金钱很适合。金钱货币才因此应运而生。所以，对于我们而言，重要的是财富本身，而不是金钱，金钱只是一种一般等价物，方便我们进行财富转移交换的媒介。财富和金钱的关系应该是这样的图景。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\"><img data-src=\"https://p.ipic.vip/orvvw2.jpg\" alt=\"\" /></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><em>物物交换存在很多弊端，比如猫有鱼想和农民换稻米，农民是有稻米但他想用稻米和猎人换活鸡，猎人是有活鸡，但他只想吃鱼。所以交易无法进行。如果有一般等价物，比如货币，猫就可以用鱼和猎人的货币交换，然后用收入的货币和农民交换稻米。其他角色也如此，于是大家都换到自己心仪的商品。</em></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"蛋糕谬论\"><a class=\"anchor\" href=\"#蛋糕谬论\">#</a> 蛋糕谬论</h1>\n<p>会有人误以为，世界上的财富总量是恒定的，在这样的上下文里，我们总是将财富称作为 “蛋糕”，但其实，财富的创造并非是零和游戏，不是我赚点，就注定有人要吃亏。<strong>蛋糕是可以做大的</strong>。比如，今年的夏天，与其在屋子里干坐着碌碌无为，我把自家后院的荒地开垦，种了草莓，这就是在创造财富，水果成熟时，可以采摘拿到市场售卖换金钱。这个过程中，我变得富有了，但并没有人因此变得更加贫穷。伴随人类历史，财富总是不停地被创造和毁灭，但总体上，创造多于毁灭。</p>\n<h1 id=\"法治\"><a class=\"anchor\" href=\"#法治\">#</a> 法治</h1>\n<p>在一个法治国家，每个人都可以自由地追逐财富，并自由使用，国家财富会逐步增加，蛋糕可以越做越大。不用担心窃取财富。毕竟，如果知道积累财富的最终结果是被他人夺取和打击，我们自然就不会去创造那么多的财富。从以前的打土豪劣绅，到最近马斯克的提问 “马云去哪里了？…… 我只是好奇，随口问一下”。</p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<ul>\n<li>[1] <span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC5tLndpa2lwZWRpYS5vcmcvemgtaGFucy8lRTklOUMlODAlRTYlQjElODIlRTglODglODclRTQlQkUlOUIlRTclQjUlQTY=\"> 供需曲线 </span></li>\n<li>[2] [ How to make wealth in hackers and painters ]</li>\n</ul>\n",
            "tags": [
                "财富，赚钱"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2022/10/06/tear-down-the-wall/",
            "url": "https://limxtop1989.github.io/limxtop/2022/10/06/tear-down-the-wall/",
            "title": "tear down the wall",
            "date_published": "2022-10-06T02:21:11.000Z",
            "content_html": "<h1 id=\"引言\"><a class=\"anchor\" href=\"#引言\">#</a> 引言</h1>\n<p>世界上有许多人确实不懂，或者说他们不明白什么是自由世界和共产主义世界的根本分歧。让他们来柏林吧。有些人说，共产主义是未来的潮流。让他们来柏林吧。有些人说，我们能在欧洲或其他地方与共产党人合作。让他们来柏林吧。甚至有那么几个人说，共产主义确是一种邪恶的制度，但它可以使我们取得经济发展。“Lasst sie nach Berlin kommen.”［“让他们到柏林看看”］</p>\n<h1 id=\"马歇尔计划\"><a class=\"anchor\" href=\"#马歇尔计划\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC5tLndpa2lwZWRpYS5vcmcvemgtY24vJUU5JUE5JUFDJUU2JUFEJTg3JUU1JUIwJTk0JUU4JUFFJUExJUU1JTg4JTky\">马歇尔计划</span></h1>\n<p>马歇尔计划（英语：The Marshall Plan），官方名称为欧洲复兴计划（英语：European Recovery Program），是二战后美国对战争破坏后的西欧各国进行经济援助、协助重建的计划，对欧洲国家的发展和世界政治格局产生了深远的影响。另外除了欧洲，同期类似的经济援助在朝鲜战争后也在亚洲第一岛链与其他第三世界国家实施，受援范围大部分是今日美国的盟邦，但并未有称为马歇尔计划。</p>\n<figure>\n    <img data-src=\"https://p.ipic.vip/rhi3gk.jpg\"\n         alt=\"Albuquerque, New Mexico\">\n    <figcaption>这幅冷战时期的欧洲地图上标注了接受马歇尔计划援助的国家。蓝色圆柱代表了各国各自接受的援助相对数量。</figcaption>\n</figure>\n<h1 id=\"我是柏林人演讲者肯尼迪\"><a class=\"anchor\" href=\"#我是柏林人演讲者肯尼迪\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC5tLndpa2lwZWRpYS5vcmcvemgtbXkvJUU2JTg4JTkxJUU2JTk4JUFGJUU2JTlGJThGJUU2JTlFJTk3JUU0JUJBJUJB\">我是柏林人 (演讲者：肯尼迪)</span></h1>\n<p><img data-src=\"https://baike.baidu.com/pic/%E6%88%91%E6%98%AF%E6%9F%8F%E6%9E%97%E4%BA%BA/2557942/1/960a304e251f95cafbfd23c6c3177f3e670952b1?fr=lemma&amp;fromModule=lemma_top-image&amp;ct=single#aid=1&amp;pic=960a304e251f95cafbfd23c6c3177f3e670952b1\" alt=\"\" /></p>\n<h2 id=\"背景\"><a class=\"anchor\" href=\"#背景\">#</a> 背景</h2>\n<p>苏军在第二次世界大战时攻占柏对德国首都严加控制。起初柏林分为四区，分别由法国、英国、美国和苏联管治 苏军封锁柏林时，美军以空运的方式为柏林居民提供粮食。</p>\n<p>后来，由法英美控制的三区俨然成为西德的外飞地，被东德完全包围。（正式来说，西柏林不属于西德；柏林全市在两德统一前都受盟军军法统治。）1952 年起，东西之间的边境关闭，只有柏林分界仍然开放。成千上万的东德人经西柏林转投西方，流失的劳动力足以使东德经济崩溃。</p>\n<p>1961 年，瓦尔特・乌布利希领导的东德政府在西柏林周围树立了一堵布满尖刺的围墙。东德政府称之为 “反法西斯防卫墙”，声称围墙用于防止西德 “法西斯政权” 的间谍和特工进入东方。这就是柏林墙，全世界绝大部分意见都认为这是用于防止东德市民逃亡。数个月后，围墙改以混凝土建造，“死亡地带” 的建筑物被拆毁，由东德守卫持机枪驻守。柏林墙建立后，柏林从原本东欧移民到西欧最简单的地方变成了最难的地方。1962 年，彼得・费查因尝试越过围墙，成为第一个死在围墙前的东德人。</p>\n<p>包括美国在内的西方阵营被指责没有致力阻止围墙树立。1961 年 7 月 25 日，即美军 4 月猪湾入侵古巴失败后不久，肯尼迪发表总统演说，重申美国拥有 “四国权利”，会坚决防卫西柏林，但同时表示无法阻止苏军继续占领东德。<br />\n<img data-src=\"https://p.ipic.vip/m4c7b9.jpg\" alt=\"\" /></p>\n<h2 id=\"译文\"><a class=\"anchor\" href=\"#译文\">#</a> 译文</h2>\n<p>二千年以前，最自豪的夸耀是 “Civis Romanus sum”［“我是罗马公民”］，今天，自由世界最自豪的夸耀是 “Ich bin ein Berliner”［“我是柏林人”］。</p>\n<p><strong>世界上有许多人确实不懂，或者说他们不明白什么是自由世界和共产主义世界的根本分歧。让他们来柏林吧。有些人说，共产主义是未来的潮流。让他们来柏林吧。有些人说，我们能在欧洲或其他地方与共产党人合作。让他们来柏林吧。甚至有那么几个人说，共产主义确是一种邪恶的制度，但它可以使我们取得经济发展。“Lasst sie nach Berlin kommen.”［“让他们到柏林看看”］</strong></p>\n<p><strong>自由有许多困难，民主亦非完美，然而我们从未建造一堵墙把我们的人民关在里面，不准他们离开我们</strong>。我愿意我的同胞们 —— 他们与你们远隔千里住在大西洋彼岸 —— 说，他们为能在远方与你们共有过去十八年的经历感到莫大的骄傲。我不知道还有哪一个城镇或都市被围困十八年仍葆有西柏林的这种生机、力量、希望和决心。全世界都看到，柏林墙最生动最明显地表现出一种失败。但我们对此并不感到称心如意，因为柏林墙既是对历史也是对人性的冒犯，它拆散家庭，造成妻离子散骨肉分离，把希冀统一的一个民族分成两半。</p>\n<p>这个城市的事实也用于整个德国 —— 只要四个德国人中有一个被剥夺了自由人的基本权利，即自由选择的权利，那么欧洲真正持久的和平便绝无可能实现。经过保持和平与善意的十八年，这一代德国人终于赢得自由的权利，包括在持久和平中善所有的人民，实现家庭团聚和民族统一的权利。你们住在受到保护的一座自由之岛上，但你们的生活是大海的一部分。因此让我在结束讲话时请求你们抬起目光，超越今日的危险看到明天的希望；超越这道墙看到正义的生平来临的一天；超越你们自己和我们自己看到全人类。自由是不可分割的，只要一人被奴役，所有的人都不自由。当所有的人都自由了，那时我们便能期待这一天的到来：在和平与希望的光辉中这座城市获得统一，这个国家获得统一，欧洲大陆获得统一。当这一天最终来临 --- 它必将来临 --- 时，西柏林人民将能对这一点感到欣慰：几乎二十年时间里他们站在第一线。</p>\n<p>一切自由人，不论他们住在何方，皆是柏林市民，所以作为一个自由人，我为 “Ich bin ein Berliner” 这句话感到自豪。</p>\n<h2 id=\"原文\"><a class=\"anchor\" href=\"#原文\">#</a> 原文</h2>\n<p>Two thousand years ago the proudest boast － was &quot;Civitas Romanus sum.&quot; Today, in the world of freedom, the proudest boast is &quot;Ich bin ein Berliner.&quot;</p>\n<p>There are many people in the world who really don't understand, or say they don't, what is the great issue between the free world and the Communist world. Let them come to Berlin. There are some who say that Communism is the wave of the future. Let them come to Berlin. And there are some who say in Europe and elsewhere we can work with the Communists. Let them come to Berlin. And there are even a few who say that it is true that Communism is an evil system, but it permits us to make economic progress. &quot;Lasst sie nach Berlin kommen.&quot;</p>\n<p>Freedom has many difficulties and democracy is not perfect, but we have never had to put a wall up to keep our people in, to prevent them from leaving us. I want to say, on behalf of my countrymen, who live many miles away on the other side of the Atlantic, who are far distant from you, that they take the greatest pride that they have been able to share with you, even from a distance, the story of the last eighteen years. I know of no town, no city, that has been besieged for eighteen years that still lives with the vitality and the force, and the hope and the determination of the city of West Berlin. While the wall is the most obvious and vivid demonstration of the failures of the Communist system. for all the world to see, we take no satisfaction in it, for it is an offense not only against history but an offense against humanity, separating families, dividing husbands and wives and brothers and sisters, and dividing a people who wish to be joined together.</p>\n<p>What is true of this city is true of Germany － real, lasting peace in Europe can never be assured as long as one German out of four is denied the elementary right of free men, and that is to make a free choice. In eighteen years of peace and good faith, this generation of Germans has earned the right to be free, including the right to unite their families and their nation in lasting peace with good will to all people. You live in a defended island of freedom, but your life is part of the main. So let me ask you, as I close, to lift your eyes beyond the dangers of today to the hopes of tomorrow, beyond the freedom merely of this city of Berlin, or your country of Germany, to the advance of freedom everywhere, beyond the wall to the day of peace with justice, beyond ourselves and ourselves to all mankind. Freedom is indivisible, and when one man is enslaved, all are not free. When all are free, then we can look forward to that day when this city will be joined as one－ and this country, and this great continent of Europe－ in a peaceful and hopeful glow. When that day finally comes, as it will, the people of West Berlin can take sober satisfaction in the fact that they were in the front lines for almost two decades.</p>\n<p>All free men, wherever they may live, are citizens of Berlin, and, therefore, as a free man, I take pride in the words &quot;Ich bin ein Berliner.&quot;</p>\n<h1 id=\"推倒这堵墙演讲者里根\"><a class=\"anchor\" href=\"#推倒这堵墙演讲者里根\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLXNnLyVFNiU4RSVBOCVFNSU4MCU5MiVFOSU4MCU5OSVFNSVBMCVCNSVFNyU4OSU4NiVFRiVCQyU4MQ==\">推倒这堵墙！(演讲者：里根)</span></h1>\n<h2 id=\"背景-2\"><a class=\"anchor\" href=\"#背景-2\">#</a> 背景</h2>\n<p>1961 年，受苏联支持的东德为防止东德人迁往西方，开始建造柏林墙，成为冷战的重要象征 [3]。其后，美国总统约翰・肯尼迪 1963 年在 “我是柏林人” 演说中，表达美国对西德的支持 [4]。</p>\n<p>1980 年代，美国在欧洲布置了短程导弹，军力为和平时期空前之强大，使当时东西方关系极度紧张 [5]。1987 年，里根出席在意大利威尼斯举办的七国峰会后，应邀短暂到访柏林 [6] 。这是他五年来第二次到访柏林。</p>\n<p>选择勃兰登堡门，用意是突显里根的言论：西方民主是打开柏林墙的最佳希望 [2]。演说的重点是以一连串的政治运动达成这个目标；“推倒这堵墙” 用作总结里根提出的各项建议。起草演讲辞时，这句子引起幕僚中相当大的争议。一些高级官员和总统助手提出删去这句子，以免东西方紧张关系加剧，或者使友好的戈尔巴乔夫感到不安。西德的美国官员和总统演辞写手却不表认同；其中，演辞写手彼得・罗宾逊在西德视察演讲场地时，感到大部分西柏林人都反对围墙。虽然没有证据证明里根的确要把围墙拆除，但罗宾逊还是在演讲辞中加入了这句话。5 月 18 日，里根看过演讲辞后，赞赏它写得很好。白宫幕僚长霍华德・贝克不同意，指出它内容 “极端”，不是总统应该说的；国家安全顾问克林・鲍威尔同意贝克的意见。然而，里根很喜欢这段演讲辞，决定保留 [7]。</p>\n<h2 id=\"演说\"><a class=\"anchor\" href=\"#演说\">#</a> 演说</h2>\n<p>1987 年 6 月 12 日，里根和夫人抵达柏林后去到国会大厦，从阳台观看围墙 [8]。当天下午 2 时 20 分，里根受两块防弹玻璃保护，免受东柏林的狙击手袭击，在勃兰登堡门发表演说 [2]。有 45,000 名观众在场观看，包括西德总统里夏德・冯・魏茨泽克、总理赫尔穆特・科尔和西柏林市长埃贝哈德・迪普根 [8]。 演说中最著名的一段是：</p>\n<p>“我们乐见改变和开放；因为我们相信自由与安全并行，人类自由的进步令我们更努力追求世界和平。苏联可以做一件很明显的事，一件大幅促进自由与和平的事。戈尔巴乔夫总书记，如果你要寻求和平，如果你要为苏联和东欧寻求繁荣，如果你要寻求自由：就到这扇门来吧！戈尔巴乔夫先生，打开这扇门！戈尔巴乔夫先生，推倒这堵墙！[8]\t”<br />\n 里根在演说中的尾声说道：“不久之前，我从国会大厦──德国统一的体现──观望，看见围墙上以喷漆粗糙写的字──也许是一位年轻的柏林人写的，‘这堵墙会倒下。信念可成真。’对，这堵墙会在欧洲倒下；因为它抵挡不了信心，它抵挡不了真理，这堵墙抵挡不了自由。”[8]</p>\n<p>演说中的另一个焦点，是里根明确提及 SS-20 核子武器的威胁，呼吁苏联停止军备竞赛，并提出 “不仅是控制军备增长，而是史无前例地移除地球上所有核子武器。”[2]</p>\n<h2 id=\"译文-2\"><a class=\"anchor\" href=\"#译文-2\">#</a> 译文</h2>\n<p>非常感谢。</p>\n<p>科尔总理、迪普根市长、女士们、先生们：</p>\n<p>二十四年前，约翰・F・肯尼迪总统访问了柏林，在市政厅里面对这个城市以及全世界的人民发表了讲话。在那之后，有两位总统访问了柏林。今天，我自己，也第二次来到了你们的城市。</p>\n<p>我们这些美国总统来到柏林，是因为我们有责任在这里为自由呼吁。但是我也必须承认，我们之所以来到这里，还有其他的原因：这个城市历史悠久，比我的国家还要年长 500 岁；格吕讷瓦尔德（Grunewald）和蒂尔加滕（Tiergarten）优美瑰丽，引人入胜；而最主要的原因是，我被你们的勇气和决心所打动。作曲家保罗・林克，也许同我们这些美国总统有着共鸣。你们瞧，就像我之前的许多总统，我今天来到这里，是因为我无论走到哪里，无论我干什么：Ich hab noch einen Koffer in Berlin（我还有个箱子在柏林）。</p>\n<p>我们今天这个集会，正在面向整个西欧和北美进行广播。我知道，在东面，人们也在看着、听着。对那些东欧的倾听者，我有一言相赠：我虽然没有和你们站在一起，但我也在对你们讲话，正如我是在对我面前的这些人们讲话一样。我同你们、你们在西面的同胞一样，都有一个坚定的、不可变更的信念：Es gibt nur ein Berlin（只有一个柏林）。</p>\n<p>在我身后，耸立着一道墙，这堵墙环绕着这个城市的自由之地，它本身也只是分裂了整个欧洲大陆的庞大壁垒的一部分。从波罗的海向南，这个壁垒横裂德国，处处扎满铁丝网，浇筑混凝土，军犬巡逻不休，警戒塔密布。再向南，那里可能没有看得见的墙，但是那里仍然有着武装警卫和检查站 —— 仍然限制着人们的出行自由，仍然把极权主义国家的意志强加于每一个普通男女之上。</p>\n<p>然而，在这里，在柏林，这堵墙把这一点凸显的最为明显。正是在这里，新闻图片和电视屏幕都在全世界人们的心上烙刻着这道横贯你们的城市、分裂整个大陆的伤痕。每一个站在勃兰登堡门前的人都是德国人，同自己的骨肉同胞分离。每一个人都是柏林人，被迫俯视一道伤痕。</p>\n<p>冯・魏茨泽克总统曾经说过：“只要勃兰登堡门还关闭着，德国问题就将存在。” 今天我要说：只要这道门还关闭着，只要这堵墙带来的疤痕仍然被允许存在，那么长存的就不仅仅只是德国问题，还有整个人类的自由问题。我到这里来不是为了哀悼，因为我在柏林找到了一个希望，即使在这堵墙的阴影之下，仍然有着胜利的消息。</p>\n<p>在 1945 年春季，当柏林人民步出隐蔽所的时候，他们发现的是一片狼藉。数千英里之外，美国人民伸出了援手。在 1947 年，正如你们知道的那样，美国国务卿乔治・马歇尔宣布了那个将来会称之为马歇尔计划的援助方案。在四十年前的今天，他说：“我们的政策不针对任何国家、任何主义，我们针对的是饥饿、贫穷、绝望和混乱。”</p>\n<p>稍前时候，在德国国会大厦，我参观了一个纪念马歇尔计划四十周年的展览，在一个曾被熔毁的、正在得到重建的建筑物上，我看到了一个标语，这个标语深深的打动了我。我知道，我这一代的柏林人都还记得，在西柏林，曾经遍布着这样的标语。这个标语是：“为加强自由世界，马歇尔计划在这里伸出援手。” 一个强大的、自由的西方世界，这个梦想变成了现实。日本从废墟中崛起成为一个经济巨人，意大利、法兰西、比利时，几乎每一个西欧国家都见证了政治上和经济上的复兴，欧共体也得以诞生。</p>\n<p>在西德，在柏林，发生了经济奇迹，the Wirtschaftswunder（德国奇迹）。<strong>阿登纳、艾哈德、鲁伊特等领导人深知自由在实践上的重要意义，只有当新闻记者被赋予言论自由之时真相才会浮现，只有农民和商人能够享受到经济自由的时候，繁荣才会到来。德国领导人削减关税，扩大自由贸易，降低税率。仅仅在 1950 年到 1960 年十年间，西德和柏林的生活水准就成倍翻升</strong>。</p>\n<p>在西柏林，四十年前还是一片废墟的地方，现在是德国产出最大的工业区，到处是繁忙的办公区、优良的住宅和公寓、热闹的大街，和不断蔓延的公园草坪。在当年似乎是文化荒漠的地方，现在有两所最好的大学、乐团和一家歌剧院，无数的剧场和博物馆。在过去是匮乏，在现在是极大丰富 —— 食物、衣物、汽车 —— 在库达姆大街上应有尽有。在废墟上，从毁灭处，你们这些柏林人在自由中重建了地球上最伟大的城市之一。苏联人或许有其他的计划，但是我的朋友们，有些东西是苏联人永远指望不上的，那就是柏林人的心灵、柏林人的幽默，和柏林人的刚毛浓眉（Schnauze）。</p>\n<p>在 20 世纪 50 年代，<strong>赫鲁晓夫曾预言：“我们将埋葬你们”。但是在今天的西方，我们看到的是一片前所未有的繁荣和安宁。而在共产主义世界，我们看见了失败，看见了技术上的落后，看见了健康的倒退，看见了即使连最起码的东西 —— 食品 —— 都极度匮乏的情形！即使到了今天，苏联人仍然不能喂饱自己。在四十年之后的今天，在整个世界面前，耸立着一个伟大和必然的结论：自由导致繁荣，自由用礼让和宽容代替了各国之间古老的仇恨。自由是胜利者</strong>！</p>\n<p>现在苏联人自己，可能在某种程度上，也明白了自由的重要性。我们经常从莫斯科听到一些消息，一项改革和开放的新政策已经出台，一些政治犯已经得到释放，某些外国新闻广播不再被屏蔽，一些经济企业已经被允许拥有更多的自主权。</p>\n<p>这些举动是苏联发生巨大转变的开始吗？或者他们仅仅是做出姿态，想要在西方掀起错误的希望，又或者仅仅是企图在不更改苏联体制的前提下修修补补？我们欢迎变化和开放 ，因为我们相信自由和安全相伴，人类自由的进步只会加强世界的和平。这里有一件事是苏联人可以做出来而不至于遭到误解的，这件事将里程碑式的促进人类的自由和和平事业。</p>\n<p>戈尔巴乔夫总书记，如果你真的在寻求和平，如果你真的在寻求苏联和东欧的繁荣昌盛，如果你真的在寻求自由化，那么，到这扇门前来吧。戈尔巴乔夫先生，把这扇门打开！戈尔巴乔夫先生，把这堵墙拆掉！</p>\n<p>我理解战争的恐惧、分离的痛苦折磨着这片大陆，我向你们保证，我的国家会帮助克服这些障碍，为了万无一失，我们自由世界必须抵抗苏联的扩张，因此我们必须保持牢不可破的防御力量。然而我们也在寻求和平，因此我们也必须做出努力来削减双方的军备。</p>\n<p>从十年之前开始，苏联人带来了一种新的致命威胁，挑战着西方联盟，他们部署了数百枚更新式、更致命的 SS-20 核导弹，足以摧毁欧洲每一个都市。西方联盟则以相应的部署以牙还牙，除非苏联人同意进行谈判找到一个更好的解决方式，也就是双方都共同消除这样的武器，否则局面就只好这么僵持下来。</p>\n<p>这么多日子以来，那些苏联人一直拒绝进行诚实的谈判。在我们一方，随着联盟准备进行相应部署，也出现了一些困难的时光，比方说我在 1982 年访问这座城市的时候有许多人起来抗议，比方说苏联人稍后离开了谈判桌。</p>\n<p>但尽管有这些困难，我们的联盟仍然坚持住了，我邀请那时抗议的那些人，<strong>我邀请今天抗议的这些人，来注意到这样一个事实，那就是，因为我们的强硬，苏联人最后又回到了谈判桌上。因为我们的强硬，今天我们能做到的，不仅仅只是期望限制军备的增长，而且还包括这样一种可能，那就是将一整类核武器彻底的从地球上废除掉</strong>。</p>\n<p>当我讲话时，北约的部长们正在冰岛会晤，对这一建议的进展状况进行讨论。在日内瓦会谈中，我们也提出了要对进攻性战略武器进行大的削减。西方联盟已经提出了许多内容深广的提议，来减少发生常规战争的危险，以及彻底禁绝化学武器。</p>\n<p>当我们裁减这些军备的时候，我也向你们保证，我们将保持能力，以阻止苏联在任何层次上发动侵略。我们正在同许多盟友合作对 “战略防御构想” 计划进行研究，不是将威慑构基于威胁报复之上，而是着眼于真正的进行防御。简言之，这套防御体系将不瞄准平民，而是保护他们。通过这种方式，欧洲和全世界的安全将得以增强。</p>\n<p>但是我们必须牢记一个至关重要的事实：东方和西方彼此确信对方，是因为我们手里都有武装，我们有武装，又是因为我们彼此不信任。使东西方意见不同的不是武器本身，而是对自由的不同理解。在肯尼迪总统 24 年前在市政厅演讲时，自由被包围，柏林在围困中。然而今天，尽管敌人对这个城市施加了那么多压力，柏林仍然安全的沐立在自由之光下，自由本身也在改变着整个世界。</p>\n<p>在菲律宾、在南美和中美洲，民主已经获得重生。在整个太平洋地区，<strong>自由市场正在制造一个又一个经济增长的奇迹</strong>。在工业化国家，一次技术革命正在发生，这次技术革命的标志是计算机和电信方面的迅速发展。</p>\n<p>在欧洲，<strong>只有一个国家和它控制的那些卫星国拒绝加入自由阵营</strong>，然而在这个经济成倍增长的时代中，在这个信息与革新的时代中，苏联面临着一个选择：它必须进行根本的改变，否则它将变得过时。</p>\n<p>因此，今天就代表着希望。我们西方准备好与东方进行合作，促进真正的开放，打破分离人们的藩篱，建立一个安全和自由的世界。我想，没有哪个地方比柏林，这个连接东西方人民的地方，更适合作为一个起点。</p>\n<p>柏林的自由人民们，美国今天会像过去一样，坚定的遵守并执行 1971 年的四大国协议。让我们借这个机会，本市的 750 周年纪念日，迎接一个新的时代，建设一个更加充实、更加富裕的柏林。让我们维护并发展联邦德国与西柏林之间的联系，这是 1971 年协议所允许的。</p>\n<p>并且我将邀请戈尔巴乔夫先生：让我们一起为东西柏林的人们多做点工作吧，使它们靠的更紧一点，以便整个柏林的全部居民都能享受到生活在这个世界上最伟大的都市之一所带的来的乐趣。</p>\n<p>要进一步向整个欧洲、东方和西方开放柏林，我们就要扩展进入这个城市的重要空中通道，使通向柏林的商业航空服务更便利、更舒适，也更经济。我们期待着有一天西柏林可以成为整个中欧地区的主要航空枢纽之一。</p>\n<p>同我们的法国和英国同伴一起，美国准备在柏林召开各种国际会议。对柏林这个城市来说，召开联合国会议，或者有关人权、军备控制等等需要国际合作的议题的国际会议，是再合适也不过。</p>\n<p>要为将来带来希望，没有比点亮青年心灵更好的方法。我们将极为荣幸的赞助（东西柏林的）夏季青年交流、各类文化活动，以及为东柏林青年举办的其他活动。我们法国和英国的朋友，我敢肯定，也将这样做。我也希望东柏林当局能够赞助西柏林青年的访问活动。</p>\n<p>我心中最后一个建议是：运动是快乐与高贵之源，您可能会注意到，南韩已经允许 1988 年夏季奥运会的某些赛事在北方举行。各种国际体育比赛也可以在这个城市的两个部分举行。假如在将来的某一年，奥林匹克运动会能够在柏林 —— 东柏林与西柏林 —— 举行，那么还有什么更好的方式，比这，更能向世界展示柏林这个城市的开放呢？</p>\n<p>在这 40 年中，正如我所说，你们柏林人建立了一个伟大的城市。尽管存在着许多威胁 —— 苏联所强加的关口和封锁，你们还是做到了。尽管有这堵墙所隐喻着的挑战，这个城市仍然蓬勃发展。是什么使你们坚持下来？当然有许多原因，比方说你们的毅力，你们抵抗的勇气。但是我相信有些原因更加深邃，涉及到的是柏林整体的观感和生活方式，而不仅仅只是情操。</p>\n<p>没有人能够在柏林生活长久还能满心幻想的，他们看到了柏林生活的困难，但选择接受之，尽管被囚禁着人类活力和希望的极权主义制度所包围，他们仍然继续建设着这个美好的、令人自豪的城市。那是一种强有力的声音，这种声音对这座城市，对未来，对自由大声说 “是”。简言之，我会把这种东西称之为 “爱”—— 深刻而持久的爱。</p>\n<p>也许这就是问题的根源，这就是东西方之间最根本的区别。极权主义的世界生产落后，因为它侵犯这种精神，阻碍了人类去创造、去享受、去感悟的冲动。极权主义的世界，甚至觉得爱和宗教的符号是一种侮辱。</p>\n<p>几年前，当东德开始重建自己的教堂之前，他们建设了一个世俗建筑物：亚历山大广场电视塔。自那以后，东德当局一直在努力纠正（在他们眼中）该塔的一个重大缺陷，往其顶部的玻璃球上倾倒各种涂料和化学物品。然而，只到今天，每当阳光照射到这些玻璃上，阳光还是照射出一个十字架的摸样。在这里，在柏林，爱的符号，礼拜的符号，不会受到压制。</p>\n<p>当我之前从国会大厦 —— 这个德国统一的化身 —— 往外望的时候，我发现了一串喷漆在柏林墙上的话，这可能是一个年轻的柏林人写下来的，“这堵墙终将倒下，梦想终将成为现实。” 是的，整个欧洲，这堵墙终将倒下，因为，它经不起良知的考验，它经不起真理的追问，它经不起自由的期望！</p>\n<p>我想，在结束发言前，还说一句话。我已经知道 —— 我也被问过了 —— 我来到这里的时候，有人举行了一些示威活动。我想对那些示威者说一件事，我不知道他们是否想到，如果他们确实有了他们所希望建立的那种政府，就没有人能够做他们现在在做的那些事情了。</p>\n<p>谢谢大家，上帝保佑你们。</p>\n<h2 id=\"后续\"><a class=\"anchor\" href=\"#后续\">#</a> 后续</h2>\n<p>29 个月后，因应东德的激烈抗议，戈尔巴乔夫允许柏林市民拆卸围墙，苏联不久后也解体了；拆掉围墙成为东欧剧变的重要因素。1990 年 9 月，已卸任美国总统的罗纳德・里根再度去到柏林，亲自举起锤子，象征式敲击柏林墙的遗迹。</p>\n<p>两德统一后首任总统赫尔穆特科尔表示，他永远不会忘记里根站在他身旁，呼吁戈尔巴乔夫推倒柏林墙。科尔说：“他是世界之福，特别是欧洲之福。” 虽然有一些意见认为里根之言对柏林墙坍塌没有帮助，但这篇演说已成为冷战时期的重要一刻。</p>\n<h2 id=\"原文-2\"><a class=\"anchor\" href=\"#原文-2\">#</a> 原文</h2>\n<p>Remarks at the Brandenburg Gate<br />\nWest Berlin, Germany<br />\nJune 12, 1987<br />\nPresident Ronald Reagon:</p>\n<p>Thank you. Thank you, very much.</p>\n<p>Chancellor Kohl, Governing Mayor Diepgen, ladies and gentlemen: Twenty four years ago, President John F. Kennedy visited Berlin, and speaking to the people of this city and the world at the city hall. Well since then two other presidents have come, each in his turn to Berlin. And today, I, myself, make my second visit to your city.</p>\n<p>We come to Berlin, we American Presidents, because it’s our duty to speak in this place of freedom. But I must confess, we’re drawn here by other things as well; by the feeling of history in this city — more than 500 years older than our own nation; by the beauty of the Grunewald and the Tiergarten; most of all, by your courage and determination. Perhaps the composer, Paul Linke, understood something about American Presidents. You see, like so many Presidents before me, I come here today because wherever I go, whatever I do: “Ich hab noch einen Koffer in Berlin” [I still have a suitcase in Berlin.]</p>\n<p>Our gathering today is being broadcast throughout Western Europe and North America. I understand that it is being seen and heard as well in the East. To those listening throughout Eastern Europe, I extend my warmest greetings and the good will of the American people. To those listening in East Berlin, a special word: Although I cannot be with you, I address my remarks to you just as surely as to those standing here before me. For I join you, as I join your fellow countrymen in the West, in this firm, this unalterable belief: Es gibt nur ein Berlin. [There is only one Berlin.]</p>\n<p>Behind me stands a wall that encircles the free sectors of this city, part of a vast system of barriers that divides the entire continent of Europe. From the Baltic South, those barriers cut across Germany in a gash of barbed wire, concrete, dog runs, and guard towers. Farther south, there may be no visible, no obvious wall. But there remain armed guards and checkpoints all the same — still a restriction on the right to travel, still an instrument to impose upon ordinary men and women the will of a totalitarian state.</p>\n<p>Yet, it is here in Berlin where the wall emerges most clearly; here, cutting across your city, where the news photo and the television screen have imprinted this brutal division of a continent upon the mind of the world.</p>\n<p>Standing before the Brandenburg Gate, every man is a German separated from his fellow men.</p>\n<p>Every man is a Berliner, forced to look upon a scar.</p>\n<p>President Von Weizsäcker has said, “The German question is open as long as the Brandenburg Gate is closed.” Well today — today I say: As long as this gate is closed, as long as this scar of a wall is permitted to stand, it is not the German question alone that remains open, but the question of freedom for all mankind.</p>\n<p>Yet, I do not come here to lament. For I find in Berlin a message of hope, even in the shadow of this wall, a message of triumph.</p>\n<p>In this season of spring in 1945, the people of Berlin emerged from their air-raid shelters to find devastation. Thousands of miles away, the people of the United States reached out to help. And in 1947 Secretary of State — as you’ve been told — George Marshall announced the creation of what would become known as the Marshall Plan. Speaking precisely 40 years ago this month, he said: “Our policy is directed not against any country or doctrine, but against hunger, poverty, desperation, and chaos.”</p>\n<p>In the Reichstag a few moments ago, I saw a display commemorating this 40th anniversary of the Marshall Plan. I was struck by a sign — the sign on a burnt-out, gutted structure that was being rebuilt. I understand that Berliners of my own generation can remember seeing signs like it dotted throughout the western sectors of the city. The sign read simply: “The Marshall Plan is helping here to strengthen the free world.” A strong, free world in the West — that dream became real. Japan rose from ruin to become an economic giant. Italy, France, Belgium — virtually every nation in Western Europe saw political and economic rebirth; the European Community was founded.</p>\n<p>In West Germany and here in Berlin, there took place an economic miracle, the Wirtschaftswunder. Adenauer, Erhard, Reuter, and other leaders understood the practical importance of liberty — that just as truth can flourish only when the journalist is given freedom of speech, so prosperity can come about only when the farmer and businessman enjoy economic freedom. The German leaders — the German leaders reduced tariffs, expanded free trade, lowered taxes. From 1950 to 1960 alone, the standard of living in West Germany and Berlin doubled.</p>\n<p>Where four decades ago there was rubble, today in West Berlin there is the greatest industrial output of any city in Germany: busy office blocks, fine homes and apartments, proud avenues, and the spreading lawns of parkland. Where a city’s culture seemed to have been destroyed, today there are two great universities, orchestras and an opera, countless theaters, and museums. Where there was want, today there’s abundance — food, clothing, automobiles — the wonderful goods of the Kudamm.¹ From devastation, from utter ruin, you Berliners have, in freedom, rebuilt a city that once again ranks as one of the greatest on earth. Now the Soviets may have had other plans. But my friends, there were a few things the Soviets didn’t count on: Berliner Herz, Berliner Humor, ja, und Berliner Schnauze. [Berliner heart, Berliner humor, yes, and a Berliner Schnauze.²]</p>\n<p>In the 1950s — In the 1950s Khrushchev predicted: “We will bury you.”</p>\n<p>But in the West today, we see a free world that has achieved a level of prosperity and well-being unprecedented in all human history. In the Communist world, we see failure, technological backwardness, declining standards of health, even want of the most basic kind — too little food. Even today, the Soviet Union still cannot feed itself. After these four decades, then, there stands before the entire world one great and inescapable conclusion: Freedom leads to prosperity. Freedom replaces the ancient hatreds among the nations with comity and peace. Freedom is the victor.</p>\n<p>And now — now the Soviets themselves may, in a limited way, be coming to understand the importance of freedom. We hear much from Moscow about a new policy of reform and openness. Some political prisoners have been released. Certain foreign news broadcasts are no longer being jammed. Some economic enterprises have been permitted to operate with greater freedom from state control.</p>\n<p>Are these the beginnings of profound changes in the Soviet state? Or are they token gestures intended to raise false hopes in the West, or to strengthen the Soviet system without changing it? We welcome change and openness; for we believe that freedom and security go together, that the advance of human liberty — the advance of human liberty can only strengthen the cause of world peace.</p>\n<p>There is one sign the Soviets can make that would be unmistakable, that would advance dramatically the cause of freedom and peace.</p>\n<p>General Secretary Gorbachev, if you seek peace, if you seek prosperity for the Soviet Union and Eastern Europe, if you seek liberalization: Come here to this gate.</p>\n<p>Mr. Gorbachev, open this gate.</p>\n<p>Mr. Gorbachev — Mr. Gorbachev, tear down this wall!</p>\n<p>I understand the fear of war and the pain of division that afflict this continent, and I pledge to you my country’s efforts to help overcome these burdens. To be sure, we in the West must resist Soviet expansion. So, we must maintain defenses of unassailable strength. Yet we seek peace; so we must strive to reduce arms on both sides.</p>\n<p>Beginning 10 years ago, the Soviets challenged the Western alliance with a grave new threat, hundreds of new and more deadly SS-20 nuclear missiles capable of striking every capital in Europe. The Western alliance responded by committing itself to a counter-deployment (unless the Soviets agreed to negotiate a better solution) — namely, the elimination of such weapons on both sides. For many months, the Soviets refused to bargain in earnestness. As the alliance, in turn, prepared to go forward with its counter-deployment, there were difficult days, days of protests like those during my 1982 visit to this city; and the Soviets later walked away from the table.</p>\n<p>But through it all, the alliance held firm. And I invite those who protested then — I invite those who protest today — to mark this fact: Because we remained strong, the Soviets came back to the table. Because we remained strong, today we have within reach the possibility, not merely of limiting the growth of arms, but of eliminating, for the first time, an entire class of nuclear weapons from the face of the earth.</p>\n<p>As I speak, NATO ministers are meeting in Iceland to review the progress of our proposals for eliminating these weapons. At the talks in Geneva, we have also proposed deep cuts in strategic offensive weapons. And the Western allies have likewise made far-reaching proposals to reduce the danger of conventional war and to place a total ban on chemical weapons.</p>\n<p>While we pursue these arms reductions, I pledge to you that we will maintain the capacity to deter Soviet aggression at any level at which it might occur. And in cooperation with many of our allies, the United States is pursuing the Strategic Defense Initiative — research to base deterrence not on the threat of offensive retaliation, but on defenses that truly defend; on systems, in short, that will not target populations, but shield them. By these means we seek to increase the safety of Europe and all the world. But we must remember a crucial fact: East and West do not mistrust each other because we are armed; we are armed because we mistrust each other. And our differences are not about weapons but about liberty. When President Kennedy spoke at the City Hall those 24 years ago, freedom was encircled; Berlin was under siege. And today, despite all the pressures upon this city, Berlin stands secure in its liberty. And freedom itself is transforming the globe.</p>\n<p>In the Philippines, in South and Central America, democracy has been given a rebirth. Throughout the Pacific, free markets are working miracle after miracle of economic growth. In the industrialized nations, a technological revolution is taking place, a revolution marked by rapid, dramatic advances in computers and telecommunications.</p>\n<p>In Europe, only one nation and those it controls refuse to join the community of freedom. Yet in this age of redoubled economic growth, of information and innovation, the Soviet Union faces a choice: It must make fundamental changes, or it will become obsolete.</p>\n<p>Today, thus, represents a moment of hope. We in the West stand ready to cooperate with the East to promote true openness, to break down barriers that separate people, to create a safer, freer world. And surely there is no better place than Berlin, the meeting place of East and West, to make a start.</p>\n<p>Free people of Berlin: Today, as in the past, the United States stands for the strict observance and full implementation of all parts of the Four Power Agreement of 1971. Let us use this occasion, the 750th anniversary of this city, to usher in a new era, to seek a still fuller, richer life for the Berlin of the future. Together, let us maintain and develop the ties between the Federal Republic and the Western sectors of Berlin, which is permitted by the 1971 agreement.</p>\n<p>And I invite Mr. Gorbachev: Let us work to bring the Eastern and Western parts of the city closer together, so that all the inhabitants of all Berlin can enjoy the benefits that come with life in one of the great cities of the world.</p>\n<p>To open Berlin still further to all Europe, East and West, let us expand the vital air access to this city, finding ways of making commercial air service to Berlin more convenient, more comfortable, and more economical. We look to the day when West Berlin can become one of the chief aviation hubs in all central Europe.</p>\n<p>With — With our French — With our French and British partners, the United States is prepared to help bring international meetings to Berlin. It would be only fitting for Berlin to serve as the site of United Nations meetings, or world conferences on human rights and arms control, or other issues that call for international cooperation.</p>\n<p>There is no better way to establish hope for the future than to enlighten young minds, and we would be honored to sponsor summer youth exchanges, cultural events, and other programs for young Berliners from the East. Our French and British friends, I’m certain, will do the same. And it’s my hope that an authority can be found in East Berlin to sponsor visits from young people of the Western sectors.</p>\n<p>One final proposal, one close to my heart: Sport represents a source of enjoyment and ennoblement, and you may have noted that the Republic of Korea — South Korea — has offered to permit certain events of the 1988 Olympics to take place in the North. International sports competitions of all kinds could take place in both parts of this city. And what better way to demonstrate to the world the openness of this city than to offer in some future year to hold the Olympic games here in Berlin, East and West.</p>\n<p>In these four decades, as I have said, you Berliners have built a great city. You’ve done so in spite of threats — the Soviet attempts to impose the East-mark, the blockade. Today the city thrives in spite of the challenges implicit in the very presence of this wall. What keeps you here? Certainly there’s a great deal to be said for your fortitude, for your defiant courage. But I believe there’s something deeper, something that involves Berlin’s whole look and feel and way of life — not mere sentiment. No one could live long in Berlin without being completely disabused of illusions. Something, instead, that has seen the difficulties of life in Berlin but chose to accept them, that continues to build this good and proud city in contrast to a surrounding totalitarian presence, that refuses to release human energies or aspirations, something that speaks with a powerful voice of affirmation, that says “yes” to this city, yes to the future, yes to freedom. In a word, I would submit that what keeps you in Berlin — is “love.”</p>\n<p>Love both profound and abiding.</p>\n<p>Perhaps this gets to the root of the matter, to the most fundamental distinction of all between East and West. The totalitarian world produces backwardness because it does such violence to the spirit, thwarting the human impulse to create, to enjoy, to worship. The totalitarian world finds even symbols of love and of worship an affront.</p>\n<p>Years ago, before the East Germans began rebuilding their churches, they erected a secular structure: the television tower at Alexander Platz. Virtually ever since, the authorities have been working to correct what they view as the tower’s one major flaw: treating the glass sphere at the top with paints and chemicals of every kind. Yet even today when the sun strikes that sphere, that sphere that towers over all Berlin, the light makes the sign of the cross. There in Berlin, like the city itself, symbols of love, symbols of worship, cannot be suppressed.</p>\n<p>As I looked out a moment ago from the Reichstag, that embodiment of German unity, I noticed words crudely spray-painted upon the wall, perhaps by a young Berliner (quote):</p>\n<p>“This wall will fall. Beliefs become reality.”</p>\n<p>Yes, across Europe, this wall will fall, for it cannot withstand faith; it cannot withstand truth. The wall cannot withstand freedom.</p>\n<p>And I would like, before I close, to say one word. I have read, and I have been questioned since I’ve been here about certain demonstrations against my coming. And I would like to say just one thing, and to those who demonstrate so. I wonder if they have ever asked themselves that if they should have the kind of government they apparently seek, no one would ever be able to do what they’re doing again.</p>\n<p>Thank you and God bless you all. Thank you.</p>\n",
            "tags": []
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2022/09/10/when-I-was-young/",
            "url": "https://limxtop1989.github.io/limxtop/2022/09/10/when-I-was-young/",
            "title": "钱很重要么？",
            "date_published": "2022-09-10T11:41:17.000Z",
            "content_html": "<p>年轻的时候，总以为钱很重要。<br />\n长大以后，才发觉，那时还是太年轻。<br />\n生活不仅有眼前的苟且，还有诗和远方。<br />\n但也需要一路的盘缠。</p>\n",
            "tags": [
                "钱，年轻"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2022/09/10/Java-IO/",
            "url": "https://limxtop1989.github.io/limxtop/2022/09/10/Java-IO/",
            "title": "Java IO",
            "date_published": "2022-09-10T02:18:36.000Z",
            "content_html": "<h1 id=\"inputstream\"><a class=\"anchor\" href=\"#inputstream\">#</a> InputStream</h1>\n<p>InputStream: 输入流的抽象，提供应用程从内存读取任意字节数（read 指针向后偏移），跳过，标记流位置（标记一个索引位置，reset 后，read 指针会重置为 mark 的值），流剩余字节数的 API。<br />\n<img data-src=\"https://p.ipic.vip/5vm3cq.jpg\" alt=\"data_structure\" /></p>\n<p><img data-src=\"https://p.ipic.vip/tb4a77.jpg\" alt=\"input_stream_class_diagram\" /></p>\n<ol>\n<li>FilterInputStream: 算是装饰者，包装或者聚合了 <code>InputStream</code> ，使用它作为基本的数据源。覆盖 <code>InputStream</code>  所有方法，简单的把方法调用转发给 <code>InputStream</code> 。</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"><span>a   </span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">InputStream</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Closeable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">InputStream</span> in<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * Creates a &lt;code>FilterInputStream&lt;/code></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     * by assigning the  argument &lt;code>in&lt;/code></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     * to the field &lt;code>this.in&lt;/code> so as</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     * to remember it for later use.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * @param   in   the underlying input stream, or &lt;code>null&lt;/code> if</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     *          this instance is to be created without an underlying stream.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">FilterInputStream</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InputStream</span> in<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>in <span class=\"token operator\">=</span> in<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"2\">\n<li>ByteArrayInputStream: 内部使用字节数组  <code>byte buf[]</code>  作为直接流数据源，每一次 read，都从 buf 读取数据。</li>\n<li>BufferedInputStream: 内部也使用字节数组  <code>byte buf[]</code> ，不过它是代理的角色， 实际的数据流是类的聚合字段 <code>InputStream in</code> ，每一次 read 都是从 buf 读取数据，buf 数据读完，会从 <code>in</code>  预读取一块数据填充  <code>buf</code> 。<br />\n一般而言，当我们使用 File 作为数据源的时候，需要配合 <code>BufferedInputStream</code>  使用 <code>new BufferedInputStream(new BufferedInputStream())</code> ，一次读取文件系统的一大块数据（涉及磁盘旋转等耗时物理操作），然后应用程序可以一次一次读取小块数据，提高性能。</li>\n<li>FileInputStream: 使用文件系统的文件作为流数据源，读取其原始的字节数据，如果要读取字符流，考虑使用 <code>FileReader</code></li>\n</ol>\n<blockquote>\n<p>A FileInputStream obtains input bytes from a file in a file system. FileInputStream is meant for reading streams of raw bytes such as image data. For reading streams of characters, consider using FileReader.</p>\n</blockquote>\n<ol start=\"5\">\n<li>ObjectInputStream: An ObjectInputStream deserializes primitive data and objects previously written using an ObjectOutputStream.</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ObjectStreamDemo</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">FileOutputStream</span> fos <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t.tmp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">ObjectOutputStream</span> oos <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectOutputStream</span><span class=\"token punctuation\">(</span>fos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        oos<span class=\"token punctuation\">.</span><span class=\"token function\">writeInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">12345</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        oos<span class=\"token punctuation\">.</span><span class=\"token function\">writeObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Today\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        oos<span class=\"token punctuation\">.</span><span class=\"token function\">writeObject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        oos<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">FileInputStream</span> fis <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t.tmp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">ObjectInputStream</span> ois <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectInputStream</span><span class=\"token punctuation\">(</span>fis<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> ois<span class=\"token punctuation\">.</span><span class=\"token function\">readInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">String</span> today <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> ois<span class=\"token punctuation\">.</span><span class=\"token function\">readObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">Date</span> date <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Date</span><span class=\"token punctuation\">)</span> ois<span class=\"token punctuation\">.</span><span class=\"token function\">readObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        ois<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"6\">\n<li>SequenceInputStream: 代表多个 <code>InputStream</code>  的逻辑拼接 <code>Enumeration&lt;? extends InputStream&gt; e</code> 。程序开始时读取数组第一个 <code>InputStream</code>  元素，读完流数据，继续读第二个元素，如此反复。</li>\n</ol>\n<blockquote>\n<p>A SequenceInputStream represents the logical concatenation of other input streams. It starts out with an ordered collection of input streams and reads from the first one until end of file is reached, whereupon it reads from the second one, and so on, until end of file is reached on the last of the contained input streams.</p>\n</blockquote>\n<ol start=\"7\">\n<li>PushbackInputStream: 在 <code>read</code>  的基础上，支持 <code>unread</code> ，程序可以提前读取后续的字节，看看是什么数据，然后 <code>unread</code>  回到原来的状态，决定如何 <code>read</code> 。类似 <code>mark &amp; reset</code> ，不同之处是 unread 额外提供数据（可能是上一次 read 的，也可能是别的）， 覆盖 reset 区域。</li>\n<li>PipedInputStream: 管道输入流必须和管道输出流连接，一般是一个线程从管道输入流读取数据，这些数据是另一个线程往管道输入流写入。单一线程使用管道输入输出流是不推荐的。PipedInputStream 构造时，传入管道输出流，并和它建立连接。</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PipedInputStream</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">InputStream</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PipedInputStream</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PipedOutputStream</span> src<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pipeSize<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>         <span class=\"token function\">initPipe</span><span class=\"token punctuation\">(</span>pipeSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PipedOutputStream</span> src<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        src<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PipedOutputStream</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">OutputStream</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PipedInputStream</span> snk<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>snk <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NullPointerException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sink <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> snk<span class=\"token punctuation\">.</span>connected<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Already connected\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        sink <span class=\"token operator\">=</span> snk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        snk<span class=\"token punctuation\">.</span>in <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        snk<span class=\"token punctuation\">.</span>out <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        snk<span class=\"token punctuation\">.</span>connected <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>管道输出流写入数据时，向管道输入流发送接收的消息。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PipedOutputStream</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">OutputStream</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> b<span class=\"token punctuation\">)</span>  <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sink <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Pipe not connected\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        sink<span class=\"token punctuation\">.</span><span class=\"token function\">receive</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>管道输入流接收管道输出流的数据，保存在  <code>buffer[in++]</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PipedInputStream</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">InputStream</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receive</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> b<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token function\">checkStateForReceive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        writeSide <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>in <span class=\"token operator\">==</span> out<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token function\">awaitSpace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>in <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            in <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            out <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        buffer<span class=\"token punctuation\">[</span>in<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>b <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>in <span class=\"token operator\">>=</span> buffer<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            in <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>     * The index of the position in the circular buffer at which the</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>     * next byte of data will be stored when received from the connected</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     * piped output stream. &lt;code>in&amp;lt;0&lt;/code> implies the buffer is empty,</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     * &lt;code>in==out&lt;/code> implies the buffer is full</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     * @since   JDK1.1</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">int</span> in <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>     * The index of the position in the circular buffer at which the next</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     * byte of data will be read by this piped input stream.</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>     * @since   JDK1.1</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">int</span> out <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://p.ipic.vip/voze2p.jpg\" alt=\"\" /><br />\n管道输入流维护写入，读出的下标索引，应用程序 <code>read</code> ，就从 buffer 读取数据 <code>int ret = buffer[out++] &amp; 0xFF;</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PipedInputStream</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">InputStream</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">int</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>connected<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Pipe not connected\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>closedByReader<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Pipe closed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>writeSide <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>writeSide<span class=\"token punctuation\">.</span><span class=\"token function\">isAlive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                   <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>closedByWriter <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>in <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Write end dead\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        readSide <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">int</span> trials <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>in <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>closedByWriter<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token comment\">/* closed by writer, return EOF */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>writeSide <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>writeSide<span class=\"token punctuation\">.</span><span class=\"token function\">isAlive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>trials <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Pipe broken\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">/* might be a writer waiting */</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token function\">notifyAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span>InterruptedIOException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">int</span> ret <span class=\"token operator\">=</span> buffer<span class=\"token punctuation\">[</span>out<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>out <span class=\"token operator\">>=</span> buffer<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            out <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>in <span class=\"token operator\">==</span> out<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token comment\">/* now empty */</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            in <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">return</span> ret<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"9\">\n<li>LineNumberInputStream: 读取字节如果是 A carriage-return character or a carriage return followed by a newline character 则 lineNumber 递增计数。应用程序可以通过 <code>java.io.LineNumberInputStream#getLineNumber</code>  获取行号记录。</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LineNumberInputStream</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">FilterInputStream</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">int</span> c <span class=\"token operator\">=</span> pushBack<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            pushBack <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            c <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>          <span class=\"token keyword\">case</span> <span class=\"token string\">'\\r'</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            pushBack <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pushBack <span class=\"token operator\">==</span> <span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                pushBack <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token keyword\">case</span> <span class=\"token string\">'\\n'</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            lineNumber<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token string\">'\\n'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">return</span> c<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"10\">\n<li>DataInputStream: 和 ObjectInputStream 类似，区别在于它只支持读取基本数据类型。</li>\n</ol>\n<blockquote>\n<p>A data input stream lets an application read primitive Java data types from an underlying input stream in a machine-independent way. An application uses a data output stream to write data that can later be read by a data input stream.</p>\n</blockquote>\n<ol start=\"11\">\n<li>SocketInputStream: socket 通信时，系统分配一个 fd 给接收端，用于接收数据。应用程序通过系统读文件的系统调用，就可以读取 fd 的数据了。</li>\n</ol>\n<blockquote>\n<p>This stream extends FileInputStream to implement a SocketInputStream. Note that this class should NOT be public.</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">SocketInputStream</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">FileInputStream</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span> b<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> off<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> length<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> timeout<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">int</span> n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// EOF already encountered</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>eof<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token comment\">// ignore</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// acquire file descriptor and do the read</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">FileDescriptor</span> fd <span class=\"token operator\">=</span> impl<span class=\"token punctuation\">.</span><span class=\"token function\">acquireFD</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            n <span class=\"token operator\">=</span> <span class=\"token function\">socketRead</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> off<span class=\"token punctuation\">,</span> length<span class=\"token punctuation\">,</span> timeout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token keyword\">return</span> n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ConnectionResetException</span> rstExc<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            gotReset <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            impl<span class=\"token punctuation\">.</span><span class=\"token function\">releaseFD</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t<span class=\"token comment\">// ignore</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        eof <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"13\">\n<li>CheckedInputStream: 维护一个读取数据的校验和功能，可以验证输入数据的完整性。</li>\n</ol>\n<blockquote>\n<p>An input stream that also maintains a checksum of the data being read. The checksum can then be used to verify the integrity of the input data.</p>\n</blockquote>\n<h1 id=\"outputstream\"><a class=\"anchor\" href=\"#outputstream\">#</a> OutputStream</h1>\n<p><img data-src=\"https://p.ipic.vip/vn8xrf.jpg\" alt=\"output_stream_class_diagram\" /><br />\n 输出流总体上和输入流类似，只是方向相反。比如 <code>BufferedOutputStream</code>  有字节缓冲区 <code>byte buf[]</code> ，接收应用程序的写入，当缓冲区写满了，就调用装饰的输出流 <code>OutputStream out</code> 。 <code>PrintStream</code>  比较特殊，涉及到 <code>Writer</code> ，我们放到 <code>Writer</code>  部分展开。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">BufferedOutputStream</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">FilterOutputStream</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     * Writes the specified byte to this buffered output stream.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * @param      b   the byte to be written.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     * @exception  IOException  if an I/O error occurs.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> b<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">>=</span> buf<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token function\">flushBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        buf<span class=\"token punctuation\">[</span>count<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">)</span>b<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"reader\"><a class=\"anchor\" href=\"#reader\">#</a> Reader</h1>\n<p><img data-src=\"https://p.ipic.vip/25ci0j.jpg\" alt=\"reader_class_diagram\" /><br />\n 一次读取 <code>InputStream</code>  的两个字节，并使用指定的字符集解析成对应字符。Java 中一个 <code>char</code>  占用 2 <code>byte</code> ，但对于 UTF-8 字符集，它的编码长度是可变的，用 1`byte・来编码常见字符。</p>\n<blockquote>\n<p>A char represents a character in Java (*). It is 2 bytes large (or 16 bits).<br />\nThat doesn't necessarily mean that every representation of a character is 2 bytes long. In fact many character encodings only reserve 1 byte for every character (or use 1 byte for the most common characters).</p>\n</blockquote>\n<ol>\n<li>InputStreamReader:  作为字节流到字符流的桥接，读取一个或者多个字节，使用字符集解码成对应的字符。使用装饰者模式实现，解码工作由 <code>StreamDecoder</code>  完成。</li>\n</ol>\n<blockquote>\n<p>An InputStreamReader is a bridge from byte streams to character streams: It reads bytes and decodes them into characters using a specified charset. The charset that it uses may be specified by name or may be given explicitly, or the platform's default charset may be accepted.<br />\nEach invocation of one of an InputStreamReader's read() methods may cause one or more bytes to be read from the underlying byte-input stream. To enable the efficient conversion of bytes to characters, more bytes may be read ahead from the underlying stream than are necessary to satisfy the current read operation.<br />\nFor top efficiency, consider wrapping an InputStreamReader within a BufferedReader. For example:<br />\n <code>BufferedReader in = new BufferedReader(new InputStreamReader(System.in));</code></p>\n</blockquote>\n<ol start=\"2\">\n<li>FileReader: 实现很言简意赅和巧妙的令人叹为观止。提供 <code>FileInputStream</code>  给 <code>InputStreamReader</code>  作字节流数据源，就完事了，整个类才三个重载的构造器。</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FileReader</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">InputStreamReader</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    * Creates a new &lt;tt>FileReader&lt;/tt>, given the name of the</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    * file to read from.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    *</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    * @param fileName the name of the file to read from</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    * @exception  FileNotFoundException  if the named file does not exist,</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    *                   is a directory rather than a regular file,</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    *                   or for some other reason cannot be opened for</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    *                   reading.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> fileName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">FileNotFoundException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"3\">\n<li>BufferedReader: 也是使用装饰者模式。内部定义一个缓冲区，一次性读取源字符流一大块字符，以此对外提供字符流。</li>\n<li>FilterReader: 同样是装饰者模式。里面啥也没做，所有的消息都转发给被装饰者，即内部的 <code>Reader</code> .</li>\n<li>PushbackReader: 撤销读的实现很巧妙，使用 <code>char[] buf;</code>  并且索引 <code>pos</code>  初始为 size，unread 的字符写在这里，后续的读优先从这里读，里面如果没有数据，再从被装饰的 <code>Reader</code>  读。</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PushbackReader</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">FilterReader</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">/** Pushback buffer */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> buf<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">/** Current position in buffer */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> pos<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * Creates a new pushback reader with a pushback buffer of the given size.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     * @param   in   The reader from which characters will be read</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     * @param   size The size of the pushback buffer</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     * @exception IllegalArgumentException if &#123;@code size &lt;= 0&#125;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PushbackReader</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Reader</span> in<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>size <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"size &lt;= 0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>buf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span>size<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pos <span class=\"token operator\">=</span> size<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"6\">\n<li>StringReader: 使用字符串作为字符流的数据源。</li>\n<li>CharArrayReader: 使用字符数组作为字符流的数据源，里面的实现就全都是数组操作了。</li>\n<li>PipedWriter: 与 <code>PipedInputStream</code>  类似，只是 API 接口参数从 <code>byte</code>  换成了  <code>char</code> 。</li>\n<li>LineNumberReader: 增加字符流里的行号识别功能。</li>\n</ol>\n<h1 id=\"writer\"><a class=\"anchor\" href=\"#writer\">#</a> Writer</h1>\n<p>与 <code>Reader</code>  方向相反，和 <code>OutputStream</code>  类似，不再赘述。<br />\n<img data-src=\"https://p.ipic.vip/d4y8ij.jpg\" alt=\"write_class_diagram\" /></p>\n<h1 id=\"randomaccessfile\"><a class=\"anchor\" href=\"#randomaccessfile\">#</a> RandomAccessFile</h1>\n<p>把文件当成一个 <code>byte[]</code> ，支持同时读写操作，读写指针做相应偏移。<br />\n<img data-src=\"https://p.ipic.vip/bjqpu6.jpg\" alt=\"\" /></p>\n<p><img data-src=\"https://p.ipic.vip/4tfurb.jpg\" alt=\"random_class_diagram\" /></p>\n",
            "tags": [
                "Java",
                "Java, IO, 源码"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2022/08/19/android-touch-event/",
            "url": "https://limxtop1989.github.io/limxtop/2022/08/19/android-touch-event/",
            "title": "Android 触摸事件派发",
            "date_published": "2022-08-19T14:42:18.000Z",
            "content_html": "<h1 id=\"return-true-at-ontouchevent-of-the-child-view-during-action-down\"><a class=\"anchor\" href=\"#return-true-at-ontouchevent-of-the-child-view-during-action-down\">#</a> Return true at onTouchEvent of the child view during action down</h1>\n<p><img data-src=\"https://p.ipic.vip/349h30.jpg\" alt=\"touch down\" /><br />\nThe subsequent move and up actions will be dispatched to the child view directly, but the parent views still have a chance to intercept the actions.<br />\n<img data-src=\"https://p.ipic.vip/9g9w2u.jpg\" alt=\"\" /></p>\n<p>Once the parent views intercept the touch event during move action by return true at  <code>onInterceptToucheEvent</code></p>\n<p><img data-src=\"https://p.ipic.vip/usy7yu.jpg\" alt=\"\" /><br />\na cancel event is generated and dispatched to the intercepted child view, in the mean while, the subsequent move and up actions will be dispatched to parent view directly rather than the child view.<br />\n<img data-src=\"https://p.ipic.vip/xyt8ic.jpg\" alt=\"\" /></p>\n<h1 id=\"return-false-at-ontouchevent-the-child-view-during-action-down\"><a class=\"anchor\" href=\"#return-false-at-ontouchevent-the-child-view-during-action-down\">#</a> Return false at onTouchEvent the child view during action down</h1>\n<p><img data-src=\"https://p.ipic.vip/ytljka.jpg\" alt=\"\" /><br />\nThe subsequent move and up actions will not be dispatched to the child view any more.<br />\n<img data-src=\"https://p.ipic.vip/7eocw3.jpg\" alt=\"\" /></p>\n",
            "tags": [
                "Android",
                "Android, Touch Event Dispatch, 触摸事件派发"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2022/07/24/Android-animation-principles/",
            "url": "https://limxtop1989.github.io/limxtop/2022/07/24/Android-animation-principles/",
            "title": "Android 动画原理",
            "date_published": "2022-07-24T14:42:18.000Z",
            "content_html": "<h1 id=\"动画原理\"><a class=\"anchor\" href=\"#动画原理\">#</a> 动画原理</h1>\n<p>动画的本质是，动画对象随着时间，从初始值到最终值的连续变化。所以，定义一个动画有三个要素，动画时间即 duration，动画初始和最终值。最基础原始的关系是动画时间和动画值成正比例（线性插值）。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable width=\"100%\"><mtr><mtd width=\"50%\"></mtd><mtd><mrow><mfrac><mi>t</mi><mrow><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>A</mi><mi>n</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow><mrow><mi>e</mi><mi>n</mi><mi>d</mi><mo>−</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></mfrac></mrow></mtd><mtd width=\"50%\"></mtd><mtd><mtext>(1)</mtext></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\frac{t}{duration} = \\frac{AnimateValue}{end - start} \\tag{1}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.9780799999999998em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.29208em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.14077em;vertical-align:-0.7693300000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.37144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">t</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693300000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"tag\"><span class=\"strut\" style=\"height:2.14077em;vertical-align:-0.7693300000000001em;\"></span><span class=\"mord text\"><span class=\"mord\">(</span><span class=\"mord\"><span class=\"mord\">1</span></span><span class=\"mord\">)</span></span></span></span></span></span></p>\n<p><img data-src=\"https://p.ipic.vip/3vgwve.jpg\" alt=\"\" /></p>\n<h1 id=\"keyframe扩展\"><a class=\"anchor\" href=\"#keyframe扩展\">#</a> KeyFrame 扩展</h1>\n<p>在 Android 内部实现上，会将初始值到最终值切分成诸多在动画时间轴均匀分布的关键帧 KeyFrame，这个类有两个重要成员变量：</p>\n<ol>\n<li>mFraction：当前关键帧对应动画时间与 duration 的比值。</li>\n<li>mValue：在当前动画时间比时，动画对象的状态值。</li>\n</ol>\n<p>抽象来看，公式<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 中，start &amp; end 对应起始关键帧：KF (0, start) 和结束关键帧: KF (1, end)。但如果只有这两个关键帧，物体就只能介于这两个关键帧的动画值之间线性变化，为了支持动画值可以挣脱这个局限，动画框架提供了关键帧的 API，指定某关键帧（mFraction, mValue），其中 mValue 可以在 [start, end] 之外。也可以提供关键帧计算函数，实现曲线运动轨迹而非线段。为此动画时间轴上 t 时，对应的动画值 V 计算方法扩展为：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable width=\"100%\"><mtr><mtd width=\"50%\"></mtd><mtd><mrow><mfrac><mrow><mfrac><mi>t</mi><mrow><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfrac><mo>−</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>−</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>v</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>A</mi><mi>n</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>−</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>v</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow></mfrac></mrow></mtd><mtd width=\"50%\"></mtd><mtd><mtext>(2)</mtext></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\frac{\\frac{t}{duration} - preKF.mFraction}{nextKF.mFraction - prevKF.mFraction} = \\frac{AnimateValue}{nextKF.value - prevKF.value} \\tag{2}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4399960000000003em;vertical-align:-0.8804400000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.5595560000000002em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">x</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.7350000000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.824556em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804400000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.25188em;vertical-align:-0.8804400000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.37144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">x</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804400000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"tag\"><span class=\"strut\" style=\"height:2.4399960000000003em;vertical-align:-0.8804400000000001em;\"></span><span class=\"mord text\"><span class=\"mord\">(</span><span class=\"mord\"><span class=\"mord\">2</span></span><span class=\"mord\">)</span></span></span></span></span></span></p>\n<p>它根据<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mi>t</mi><mrow><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{t}{duration}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.169556em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.824556em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> 和 KeyFrame.mFraction 相比较大小，计算位于哪两个 KeyFrame 区间，应用公式<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>。随着动画时间流逝，就可以在所有的 KeyFrame 应用公式<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 了。</p>\n<table>\n<thead>\n<tr>\n<th>KeyFrame.mFraction &amp; mValue 均匀线性分布</th>\n<th>KeyFrame.mFraction 线性，mValue 曲线分布</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img data-src=\"https://p.ipic.vip/xw8u0r.jpg\" style=\"zoom:50%;\" /></td>\n<td><img data-src=\"https://p.ipic.vip/9vuhf0.jpg\" style=\"zoom:50%;\" /></td>\n</tr>\n</tbody>\n</table>\n<p>注：右侧第四个红点挪到 end 右侧，动画轨迹就可以越出 end 的范围了。</p>\n<h1 id=\"变速扩展\"><a class=\"anchor\" href=\"#变速扩展\">#</a> 变速扩展</h1>\n<p>为支持非匀速动画，使用 Interpolator 将 t 篡改， <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><mrow><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{Interpolator(t)}{duration}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.355em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">p</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>，转换成别的比例。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable width=\"100%\"><mtr><mtd width=\"50%\"></mtd><mtd><mrow><mfrac><mrow><mfrac><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><mrow><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfrac><mo>−</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>−</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>v</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>A</mi><mi>n</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>−</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>v</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow></mfrac></mrow></mtd><mtd width=\"50%\"></mtd><mtd><mtext>(3)</mtext></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\frac{\\frac{Interpolator(t)}{duration} - preKF.mFraction}{nextKF.mFraction - prevKF.mFraction} = \\frac{AnimateValue}{nextKF.value - prevKF.value} \\tag{3}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.62544em;vertical-align:-0.8804400000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.745em;\"><span style=\"top:-2.324em;\"><span class=\"pstrut\" style=\"height:3.01em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">x</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-3.2399999999999998em;\"><span class=\"pstrut\" style=\"height:3.01em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.745em;\"><span class=\"pstrut\" style=\"height:3.01em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">p</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804400000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.25188em;vertical-align:-0.8804400000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.37144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">x</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804400000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"tag\"><span class=\"strut\" style=\"height:2.62544em;vertical-align:-0.8804400000000001em;\"></span><span class=\"mord text\"><span class=\"mord\">(</span><span class=\"mord\"><span class=\"mord\">3</span></span><span class=\"mord\">)</span></span></span></span></span></span></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mtext> where </mtext><mi>t</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">Interpolator(t)\\text{ where } t\\in[0, 1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mord text\"><span class=\"mord\"> where </span></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span> 其实就是一个函数，输入原始时间 t，输出篡改后的时间，约束是 Interpolator (0) = 0 &amp;&amp; Interpolator (1) = 1。由于 AnimateValue 是 t 的函数，变速动画成为可能，且容易实现。比如未引入 Interpolator 概念的公式，AnimateValue 和 t 是等比关系，只能是匀速动画，是 Interpolator (t) = t 这一特例，但它可以做的更多，比如匀加速，匀减速…… 具体是怎么变速，AnimateValue 对 t 一阶求导可以得到速度，二阶求导可以得到加速度，这样描述应该可以更容易理解。</p>\n<table>\n<thead>\n<tr>\n<th>匀速运动 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">Interpolator(t) = t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span></th>\n<th>匀加速<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">Interpolator(t) = t^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></th>\n<th>匀减速<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>p</mi><mi>o</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>1</mn><mo>−</mo><mo stretchy=\"false\">(</mo><mi>t</mi><mo>−</mo><mn>1</mn><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">Interpolator(t) = 1 - ( t - 1 ) ^ 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img data-src=\"https://p.ipic.vip/nwt407.jpg\" style=\"zoom:50%;\" /></td>\n<td><img data-src=\"https://p.ipic.vip/ajhcam.jpg\" style=\"zoom:50%;\" /></td>\n<td><img data-src=\"https://p.ipic.vip/6whz0k.jpg\" style=\"zoom:50%;\" /></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"向量扩展\"><a class=\"anchor\" href=\"#向量扩展\">#</a> 向量扩展</h1>\n<p>对于有些动画值，并非标量，不能简单的如：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mi>f</mi><mn>2.</mn><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>−</mo><mi>k</mi><mi>f</mi><mn>1.</mn><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">kf2.value - kf1.value</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord\">2</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord\">1</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span></span></span></span> 直接相减，因此引入 Evaluator，从其方法签名 <code>evaluate(float fraction, Object startValue, Object endValue)</code> ，fraction 参数值为<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span></span></span></span> 的左值，可以看出其职责为，计算出 startValue 和 endValue 之间，fraction 所对应的动画值。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable width=\"100%\"><mtr><mtd width=\"50%\"></mtd><mtd><mrow><mi>A</mi><mi>n</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mi>e</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo stretchy=\"false\">(</mo><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo separator=\"true\">,</mo><mtext> </mtext><mi>p</mi><mi>r</mi><mi>e</mi><mi>v</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo separator=\"true\">,</mo><mtext> </mtext><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>K</mi><mi>F</mi><mi mathvariant=\"normal\">.</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo stretchy=\"false\">)</mo></mrow></mtd><mtd width=\"50%\"></mtd><mtd><mtext>(4)</mtext></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">AnimateValue = evaluate(fraction, \\ prevKF.value, \\ nextKF.value) \\tag{4}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">e</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\"> </span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span><span class=\"mpunct\">,</span><span class=\"mspace\"> </span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">x</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">e</span><span class=\"mclose\">)</span></span><span class=\"tag\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">(</span><span class=\"mord\"><span class=\"mord\">4</span></span><span class=\"mord\">)</span></span></span></span></span></span></p>\n<p>以颜色值为例</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> fraction<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> startValue<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> endValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> startInt <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">)</span> startValue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> startA <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>startInt <span class=\"token operator\">>></span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">int</span> startR <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>startInt <span class=\"token operator\">>></span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">int</span> startG <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>startInt <span class=\"token operator\">>></span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">int</span> startB <span class=\"token operator\">=</span> startInt <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">int</span> endInt <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">)</span> endValue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">int</span> endA <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>endInt <span class=\"token operator\">>></span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">int</span> endR <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>endInt <span class=\"token operator\">>></span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">int</span> endG <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>endInt <span class=\"token operator\">>></span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">int</span> endB <span class=\"token operator\">=</span> endInt <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>startA <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>fraction <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>endA <span class=\"token operator\">-</span> startA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>startR <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>fraction <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>endR <span class=\"token operator\">-</span> startR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>startG <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>fraction <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>endG <span class=\"token operator\">-</span> startG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>startB <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>fraction <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>endB <span class=\"token operator\">-</span> startB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"多属性动画\"><a class=\"anchor\" href=\"#多属性动画\">#</a> 多属性动画</h1>\n<p>诸多关键帧只能描述单一对象的动画轨迹，将属性和其对应的关键帧封装为 PropertyValuesHolder，使得能够支持多个动画对象的多个属性同时动画。</p>\n<h1 id=\"动画引擎\"><a class=\"anchor\" href=\"#动画引擎\">#</a> 动画引擎</h1>\n<p>动画的内部实现使用 Choreographer 提供定时引擎，周期性回调执行上述动画值的计算，实现动画对象从上一个关键帧到下一个关键帧的动画渐变效果。</p>\n",
            "tags": [
                "Android",
                "Android, Animation, Animator"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2022/02/24/Android-view-canvas-%E5%9D%90%E6%A0%87%E7%B3%BB/",
            "url": "https://limxtop1989.github.io/limxtop/2022/02/24/Android-view-canvas-%E5%9D%90%E6%A0%87%E7%B3%BB/",
            "title": "Android view & canvas 坐标系",
            "date_published": "2022-02-24T11:22:26.000Z",
            "content_html": "<p>View 坐标系原点在 parent view 左上角，left, top, right, bottom 是 child view 左上角和右下角相对坐标轴的距离。</p>\n<img data-src=\"https://s3.bmp.ovh/imgs/2022/02/268be9e97fb1f9e7.png\" style=\"zoom:50%\" />\n<img data-src=\"https://s3.bmp.ovh/imgs/2022/02/0172ac6697998ed7.png\" style=\"zoom:50%;\" />\n",
            "tags": [
                "Android, view coordinate, canvas coordinate, 坐标系"
            ]
        },
        {
            "id": "https://limxtop1989.github.io/limxtop/2022/02/14/LifeCycle-LiveData/",
            "url": "https://limxtop1989.github.io/limxtop/2022/02/14/LifeCycle-LiveData/",
            "title": "LifeCycle & LiveData源码剖析",
            "date_published": "2022-02-14T12:33:46.000Z",
            "content_html": "<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/02/c5d4136edbfe0f20.png\" alt=\"类图\" /></p>\n<h1 id=\"生命周期回调方法映射为事件并派发给lifecycle\"><a class=\"anchor\" href=\"#生命周期回调方法映射为事件并派发给lifecycle\">#</a> 生命周期回调方法映射为事件，并派发给 LifeCycle</h1>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">androidx<span class=\"token punctuation\">.</span>fragment<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span></span>FragmentActivity</span>#onStart</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// ……</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// NOTE: HC onStart goes here.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    mFragmentLifecycleRegistry<span class=\"token punctuation\">.</span><span class=\"token function\">handleLifecycleEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Lifecycle<span class=\"token punctuation\">.</span>Event</span><span class=\"token punctuation\">.</span>ON_START<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    mFragments<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">androidx<span class=\"token punctuation\">.</span>lifecycle<span class=\"token punctuation\">.</span></span>LifecycleRegistry</span>#handleLifecycleEvent</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * Sets the current state and notifies the observers.</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * &lt;p></pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * Note that if the &#123;@code currentState&#125; is the same state as the last call to this method,</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * calling this method has no effect.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * @param event The event that was received</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handleLifecycleEvent</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">Lifecycle<span class=\"token punctuation\">.</span>Event</span> event<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token class-name\">State</span> next <span class=\"token operator\">=</span> <span class=\"token function\">getStateAfter</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token function\">moveToState</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">moveToState</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">State</span> next<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mState <span class=\"token operator\">==</span> next<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    mState <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mHandlingEvent <span class=\"token operator\">||</span> mAddingObserverCounter <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        mNewEventOccurred <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">// we will figure out what to do on upper level.</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    mHandlingEvent <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    mHandlingEvent <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">// happens only on the top of stack (never in reentrance),</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">// so it doesn't have to take in account parents</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token class-name\">LifecycleOwner</span> lifecycleOwner <span class=\"token operator\">=</span> mLifecycleOwner<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lifecycleOwner <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"LifecycleOwner of this LifecycleRegistry is already\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token operator\">+</span> <span class=\"token string\">\"garbage collected. It is too late to change lifecycle state.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isSynced</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        mNewEventOccurred <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token comment\">// no need to check eldest for nullability, because isSynced does it for us.</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\">// State descends, such as RESUMED to STARTED</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mState<span class=\"token punctuation\">.</span><span class=\"token function\">compareTo</span><span class=\"token punctuation\">(</span>mObserverMap<span class=\"token punctuation\">.</span><span class=\"token function\">eldest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>mState<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token function\">backwardPass</span><span class=\"token punctuation\">(</span>lifecycleOwner<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token comment\">// State ascends, such at STARTED TO RESUMED</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LifecycleObserver</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ObserverWithState</span><span class=\"token punctuation\">></span></span> newest <span class=\"token operator\">=</span> mObserverMap<span class=\"token punctuation\">.</span><span class=\"token function\">newest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>mNewEventOccurred <span class=\"token operator\">&amp;&amp;</span> newest <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token operator\">&amp;&amp;</span> mState<span class=\"token punctuation\">.</span><span class=\"token function\">compareTo</span><span class=\"token punctuation\">(</span>newest<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>mState<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token function\">forwardPass</span><span class=\"token punctuation\">(</span>lifecycleOwner<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    mNewEventOccurred <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://s3.bmp.ovh/imgs/2022/02/a70384d33bf36163.png\" alt=\"状态图\" /></p>\n<p>如果是状态降级，从尾部向头部遍历监听队列，如果是状态升级，从头部向尾部遍历监听队列。之所以如此区分是因为要保证 FastSafeIterableMap 的 Invariant，但为什么要维持这个不变量呢？原则上，LifeCycleOwner 从 ON_CREATED 到 ON_RESUMED，再到 ON_CREATED 是一种状态回退，监听回调顺序也要从向前到向后回退。FastSafeIterableMap 是一个 map，同时每个 Entry 是一个双向链表，新加入元素插入尾部。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">androidx<span class=\"token punctuation\">.</span>lifecycle<span class=\"token punctuation\">.</span></span>LifecycleRegistry</span>#mObserverMap</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * Custom list that keeps observers and can handle removals / additions during traversal.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * Invariant: at any moment of time for observer1 &amp; observer2:</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * if addition_order(observer1) &lt; addition_order(observer2), then</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * state(observer1) >= state(observer2),</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">FastSafeIterableMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LifecycleObserver</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ObserverWithState</span><span class=\"token punctuation\">></span></span> mObserverMap <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">FastSafeIterableMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">androidx<span class=\"token punctuation\">.</span>lifecycle<span class=\"token punctuation\">.</span></span>LifecycleRegistry</span>#backwardPass</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">backwardPass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LifecycleOwner</span> lifecycleOwner<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Entry</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LifecycleObserver</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ObserverWithState</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> descendingIterator <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            mObserverMap<span class=\"token punctuation\">.</span><span class=\"token function\">descendingIterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>descendingIterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>mNewEventOccurred<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LifecycleObserver</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ObserverWithState</span><span class=\"token punctuation\">></span></span> entry <span class=\"token operator\">=</span> descendingIterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">ObserverWithState</span> observer <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">.</span>mState<span class=\"token punctuation\">.</span><span class=\"token function\">compareTo</span><span class=\"token punctuation\">(</span>mState<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>mNewEventOccurred</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token operator\">&amp;&amp;</span> mObserverMap<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">Event</span> event <span class=\"token operator\">=</span> <span class=\"token function\">downEvent</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">.</span>mState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token function\">pushParentState</span><span class=\"token punctuation\">(</span><span class=\"token function\">getStateAfter</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            observer<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span>lifecycleOwner<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token function\">popParentState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">androidx<span class=\"token punctuation\">.</span>lifecycle<span class=\"token punctuation\">.</span></span>LifecycleRegistry<span class=\"token punctuation\">.</span>ObserverWithState</span>#dispatchEvent</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LifecycleOwner</span> owner<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Event</span> event<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">State</span> newState <span class=\"token operator\">=</span> <span class=\"token function\">getStateAfter</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    mState <span class=\"token operator\">=</span> <span class=\"token function\">min</span><span class=\"token punctuation\">(</span>mState<span class=\"token punctuation\">,</span> newState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    mLifecycleObserver<span class=\"token punctuation\">.</span><span class=\"token function\">onStateChanged</span><span class=\"token punctuation\">(</span>owner<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    mState <span class=\"token operator\">=</span> newState<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * Class that can receive any lifecycle change and dispatch it to the receiver.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * &lt;p></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * If a class implements both this interface and</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * &#123;@link androidx.lifecycle.DefaultLifecycleObserver&#125;, then</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * methods of &#123;@code DefaultLifecycleObserver&#125; will be called first, and then followed by the call</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * of &#123;@link LifecycleEventObserver#onStateChanged(LifecycleOwner, Lifecycle.Event)&#125;</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * &lt;p></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * If a class implements this interface and in the same time uses &#123;@link OnLifecycleEvent&#125;, then</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * annotations will be ignored.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">LifecycleEventObserver</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LifecycleObserver</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     * Called when a state transition event happens.</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>     * @param source The source of the event</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>     * @param event The event</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">onStateChanged</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">LifecycleOwner</span> source<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">Lifecycle<span class=\"token punctuation\">.</span>Event</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>LiveData 包 androidx.lifecycle.LiveData.LifecycleBoundObserver 实现了这个接口，接下来看如何实现和使用</p>\n<h1 id=\"监听注册\"><a class=\"anchor\" href=\"#监听注册\">#</a> 监听注册</h1>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">androidx<span class=\"token punctuation\">.</span>lifecycle<span class=\"token punctuation\">.</span></span>LiveData</span>#observe</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * Adds the given observer to the observers list within the lifespan of the given</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * owner. The events are dispatched on the main thread. If LiveData already has data</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * set, it will be delivered to the observer.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * &lt;p></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * The observer will only receive events if the owner is in &#123;@link Lifecycle.State#STARTED&#125;</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * or &#123;@link Lifecycle.State#RESUMED&#125; state (active).</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * &lt;p></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * If the owner moves to the &#123;@link Lifecycle.State#DESTROYED&#125; state, the observer will</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * automatically be removed.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * &lt;p></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * When data changes while the &#123;@code owner&#125; is not active, it will not receive any updates.</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * If it becomes active again, it will receive the last available data automatically.</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * &lt;p></pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * LiveData keeps a strong reference to the observer and the owner as long as the</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * given LifecycleOwner is not destroyed. When it is destroyed, LiveData removes references to</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * the observer &amp;amp; the owner.</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> * &lt;p></pre></td></tr><tr><td data-num=\"20\"></td><td><pre> * If the given owner is already in &#123;@link Lifecycle.State#DESTROYED&#125; state, LiveData</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> * ignores the call.</pre></td></tr><tr><td data-num=\"22\"></td><td><pre> * &lt;p></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> * If the given owner, observer tuple is already in the list, the call is ignored.</pre></td></tr><tr><td data-num=\"24\"></td><td><pre> * If the observer is already in the list with another owner, LiveData throws an</pre></td></tr><tr><td data-num=\"25\"></td><td><pre> * &#123;@link IllegalArgumentException&#125;.</pre></td></tr><tr><td data-num=\"26\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"27\"></td><td><pre> * @param owner    The LifecycleOwner which controls the observer</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> * @param observer The observer that will receive the events</pre></td></tr><tr><td data-num=\"29\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token annotation punctuation\">@MainThread</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">observe</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">LifecycleOwner</span> owner<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">Observer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> observer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token function\">assertMainThread</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"observe\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>owner<span class=\"token punctuation\">.</span><span class=\"token function\">getLifecycle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> DESTROYED<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">// ignore</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token class-name\">LifecycleBoundObserver</span> wrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LifecycleBoundObserver</span><span class=\"token punctuation\">(</span>owner<span class=\"token punctuation\">,</span> observer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token class-name\">ObserverWrapper</span> existing <span class=\"token operator\">=</span> mObservers<span class=\"token punctuation\">.</span><span class=\"token function\">putIfAbsent</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">,</span> wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>existing <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>existing<span class=\"token punctuation\">.</span><span class=\"token function\">isAttachedTo</span><span class=\"token punctuation\">(</span>owner<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cannot add the same observer\"</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token operator\">+</span> <span class=\"token string\">\" with different lifecycles\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>existing <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    owner<span class=\"token punctuation\">.</span><span class=\"token function\">getLifecycle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addObserver</span><span class=\"token punctuation\">(</span>wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>observer 被封装为 LifecycleBoundObserver，并注册到 Lifecycle 的监听队列里，当生命周期方法调用，并派发事件，最终 androidx.lifecycle.LiveData.LifecycleBoundObserver#onStateChanged 被调用，对于 LiveData 而言，它只关注两个方面：</p>\n<ol>\n<li>如果是 Lifecycle 已经 destroy，那么自动移除双向监听（对 LiveData，和对 Lifecycle 的监听）；</li>\n<li>判断 active &amp; inActive 状态变更方向，如果是 inactive →  active，说明 Lifecycle 重新回到前台，则将 LiveData 的 value 派发给监听者，提供数据刷新 UI。</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">LifecycleBoundObserver</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ObserverWrapper</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">GenericLifecycleObserver</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@NonNull</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token class-name\">LifecycleOwner</span> mOwner<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">LifecycleBoundObserver</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">LifecycleOwner</span> owner<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Observer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> observer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        mOwner <span class=\"token operator\">=</span> owner<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onStateChanged</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LifecycleOwner</span> source<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Lifecycle<span class=\"token punctuation\">.</span>Event</span> event<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mOwner<span class=\"token punctuation\">.</span><span class=\"token function\">getLifecycle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> DESTROYED<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// Remove double direction observers.</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token function\">removeObserver</span><span class=\"token punctuation\">(</span>mObserver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// Dispatch value if state changes from inactive to active.</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token function\">activeStateChanged</span><span class=\"token punctuation\">(</span><span class=\"token function\">shouldBeActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>LifecycleBoundObserver 注册观察 Lifecycle 时，需要处理注册时，错失的生命周期方法派发，将当前 LifecycleBoundObserver 的状态推送至 Lifecycle 一致。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">androidx<span class=\"token punctuation\">.</span>lifecycle<span class=\"token punctuation\">.</span></span>LifecycleRegistry</span>#addObserver</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addObserver</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">LifecycleObserver</span> observer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">State</span> initialState <span class=\"token operator\">=</span> mState <span class=\"token operator\">==</span> DESTROYED <span class=\"token operator\">?</span> DESTROYED <span class=\"token operator\">:</span> INITIALIZED<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">ObserverWithState</span> statefulObserver <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObserverWithState</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">,</span> initialState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">ObserverWithState</span> previous <span class=\"token operator\">=</span> mObserverMap<span class=\"token punctuation\">.</span><span class=\"token function\">putIfAbsent</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">,</span> statefulObserver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>previous <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">LifecycleOwner</span> lifecycleOwner <span class=\"token operator\">=</span> mLifecycleOwner<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lifecycleOwner <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// it is null we should be destroyed. Fallback quickly</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">boolean</span> isReentrance <span class=\"token operator\">=</span> mAddingObserverCounter <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> mHandlingEvent<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token class-name\">State</span> targetState <span class=\"token operator\">=</span> <span class=\"token function\">calculateTargetState</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    mAddingObserverCounter<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>statefulObserver<span class=\"token punctuation\">.</span>mState<span class=\"token punctuation\">.</span><span class=\"token function\">compareTo</span><span class=\"token punctuation\">(</span>targetState<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token operator\">&amp;&amp;</span> mObserverMap<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token function\">pushParentState</span><span class=\"token punctuation\">(</span>statefulObserver<span class=\"token punctuation\">.</span>mState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        statefulObserver<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span>lifecycleOwner<span class=\"token punctuation\">,</span> <span class=\"token function\">upEvent</span><span class=\"token punctuation\">(</span>statefulObserver<span class=\"token punctuation\">.</span>mState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token function\">popParentState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// mState / subling may have been changed recalculate</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        targetState <span class=\"token operator\">=</span> <span class=\"token function\">calculateTargetState</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isReentrance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// we do sync only on the top level.</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    mAddingObserverCounter<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"数据变更\"><a class=\"anchor\" href=\"#数据变更\">#</a> 数据变更</h1>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">androidx<span class=\"token punctuation\">.</span>lifecycle<span class=\"token punctuation\">.</span></span>LiveData</span>#setValue</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * Sets the value. If there are active observers, the value will be dispatched to them.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * &lt;p></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * This method must be called from the main thread. If you need set a value from a background</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * thread, you can use &#123;@link #postValue(Object)&#125;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @param value The new value</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token annotation punctuation\">@MainThread</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token function\">assertMainThread</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"setValue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    mVersion<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    mData <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">dispatchingValue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">androidx<span class=\"token punctuation\">.</span>lifecycle<span class=\"token punctuation\">.</span></span>LiveData</span>#dispatchingValue</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"WeakerAccess\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">/* synthetic access */</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">dispatchingValue</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Nullable</span> <span class=\"token class-name\">ObserverWrapper</span> initiator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mDispatchingValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        mDispatchInvalidated <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    mDispatchingValue <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">do</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        mDispatchInvalidated <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>initiator <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// Maxim: Lifecycle changes from inactive to active, but the data keeps still,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// notify the corresponding observer in the lifecycle owner only.</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token function\">considerNotify</span><span class=\"token punctuation\">(</span>initiator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            initiator <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//Maxim:  The data source has changed, notify all observers.</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Observer</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ObserverWrapper</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> iterator <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    mObservers<span class=\"token punctuation\">.</span><span class=\"token function\">iteratorWithAdditions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token function\">considerNotify</span><span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mDispatchInvalidated<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>mDispatchInvalidated<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    mDispatchingValue <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">considerNotify</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ObserverWrapper</span> observer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>observer<span class=\"token punctuation\">.</span>mActive<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// Check latest state b4 dispatch. Maybe it changed state but we didn't get the event yet.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// we still first check observer.active to keep it as the entrance for events. So even if</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// the observer moved to an active state, if we've not received that event, we better not</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// notify for a more predictable notification order.</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token comment\">// Maxim: Don't notify if the observer is not active, for lifecycle, it should</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token comment\">// at leat be started or above(resumed).</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>observer<span class=\"token punctuation\">.</span><span class=\"token function\">shouldBeActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        observer<span class=\"token punctuation\">.</span><span class=\"token function\">activeStateChanged</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">.</span>mLastVersion <span class=\"token operator\">>=</span> mVersion<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    observer<span class=\"token punctuation\">.</span>mLastVersion <span class=\"token operator\">=</span> mVersion<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">//noinspection unchecked</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    observer<span class=\"token punctuation\">.</span>mObserver<span class=\"token punctuation\">.</span><span class=\"token function\">onChanged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span> mData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"更多资料\"><a class=\"anchor\" href=\"#更多资料\">#</a> 更多资料</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nb29nbGUtZGV2ZWxvcGVyLXRyYWluaW5nLmdpdGh1Yi5pby9hbmRyb2lkLWRldmVsb3Blci1hZHZhbmNlZC1jb3Vyc2UtcHJhY3RpY2Fscy91bml0LTYtd29ya2luZy13aXRoLWFyY2hpdGVjdHVyZS1jb21wb25lbnRzL2xlc3Nvbi0xNC1yb29tLC1saXZlZGF0YSwtdmlld21vZGVsLzE0LTEtYS1yb29tLWxpdmVkYXRhLXZpZXdtb2RlbC8xNC0xLWEtcm9vbS1saXZlZGF0YS12aWV3bW9kZWwuaHRtbA==\">https://google-developer-training.github.io/android-developer-advanced-course-practicals/unit-6-working-with-architecture-components/lesson-14-room,-livedata,-viewmodel/14-1-a-room-livedata-viewmodel/14-1-a-room-livedata-viewmodel.html</span></p>\n",
            "tags": [
                "LifeCycle, LiveData"
            ]
        }
    ]
}